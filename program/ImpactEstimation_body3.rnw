\section{Descriptive statistics}

<<>>=
# Following files are created in ImpactEstimatin_body1.rnw using paste0(path1234, "data_read_in_a_list_with_baseline_patched.rds") further trimmed in DataTrimmingMembership1or4.rnw
s1 <- readRDS(paste0(pathsaveHere, "RosterSchoolingAdminDataUsedForEstimation.rds"))
s2 <- readRDS(paste0(pathsaveHere, "RosterAugmentedSchoolingAdminDataUsedForEstimation.rds"))
ar <- readRDS(paste0(pathsaveHere, "RosterAdminDataUsedForEstimation.rds"))
ass <- readRDS(paste0(pathsaveHere, "AssetAdminDataUsedForEstimation.rds"))
lvo <- readRDS(paste0(pathsaveHere, "LivestockAdminDataUsedForEstimation.rds"))
lab <- readRDS(paste0(pathsaveHere, "LabourIncomeAdminDataUsedForEstimation.rds"))
far <- readRDS(paste0(pathsaveHere, "FarmRevenueAdminDataUsedForEstimation.rds"))
con <- readRDS(paste0(pathsaveHere, "ConsumptionAdminDataUsedForEstimation.rds"))
MonthsOfRepayment <- 45
@

<<>>=
ass[, MonthsDiff := round(as.numeric(as.Date(IntDate) - as.Date(DistDate1))/30, 0)]
assG <- ass[, .(Arm, creditstatus, groupid, hhid, MonthsDiff, IntDate, Year, tee, 
  HAssetAmount, PAssetAmount)]
# NAs in MonthsDiff for creditstatus = No, NA. 
# NAs in creditstatus is gErosion, gRejection, iRejection, and 24 OldMembers
#summary(ass[is.na(creditstatus), .(Arm, hhid, IntDate, DisDate1, Mstatus)])
# 24 oldMembers who were surveyed did not have a match in admin data
#summary(ass[is.na(creditstatus) & grepl("^o", Mstatus), 
#  .(Arm,hhid, IntDate, DisDate1, Date)])
assG2 <- assG[!grepl("[dD]r", Arm), ]
assG2[, Arm := droplevels(Arm)]
<<household assets by Arms in calendar year, warning = F, message = F, fig.align='center', fig.height = 3, fig.width = 10, fig.cap = paste0("Household asset holding", "\\\\ {\\footnotesize \\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
mediandata <- assG[, .(HAssetAmount = median(1+HAssetAmount, na.rm = T),
  PAssetAmount = median(1+PAssetAmount, na.rm = T)), by = .(Arm, Year)]
g <- ggplot(assG, aes(IntDate, 1+HAssetAmount, colour = Arm, group = Arm)) +
  geom_point(aes(colour = Arm), size = .1, position = position_dodge(width = .5)) +
#  geom_smooth(span = .15, aes(colour = Arm, group = Arm)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1),
    legend.position="none", legend.key = element_rect(fill = "white")) + 
  scale_y_log10() +
  scale_x_datetime(date_breaks = "12 months", 
    date_labels = "%Y", #date_labels = "%b-%Y"
    date_minor_breaks = "6 months") +
  xlab("Dates") + ylab("Household asset amount (Tk)") +
  facet_grid(. ~ Arm, scales = "free_y")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/HouseholdAssetHoldingCalendarYear.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
<<household assets by Arms, warning = F, message = F, fig.align='center', fig.height = 3, fig.width = 10, fig.cap = paste0("Household asset holding", "\\\\ {\\footnotesize \\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
g <- ggplot(assG2, aes(MonthsDiff, 1+HAssetAmount, colour = Arm, group = Arm)) +
  geom_point(aes(colour = Arm), size = .1, position = position_dodge(width = .5)) +
  geom_smooth(span = .5, aes(colour = Arm, group = Arm)) +
  theme(legend.position="none", legend.key = element_rect(fill = "white")) + 
  scale_y_log10() +
  scale_x_continuous(limits = c(-12, 48), breaks = seq(-12, 48, 12)) +
  xlab("Months since 1st loan disbursement") + ylab("Household asset amount (Tk)") +
  facet_grid(. ~ Arm, scales = "free_y")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "HouseholdAssetHoldingMonthsSinceDisbursement.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
@

\section{Estimation}


\subsection{Schooling}

<<ReadTrimSchoolingFDData, cache = F, child='c:/data/GUK/analysis/program/ReadTrimSchoolingFDData.rnw'>>=
@
If using \textsf{s1}, retain only the complete portion of panel. \textsf{sch1} has \Sexpr{nrow(s01)} rows. Drop \Sexpr{nrow(s01[grepl("nnn", Spattern), ])} observations in \textsf{sch1} with nnn in \textsf{Spattern} and \Sexpr{nrow(s01[!grepl("nnn", Spattern) & grepl("1001", EnrollPattern), ])} observations with 1001 in \textsf{EnrollPattern} because they are likely to be errors. This leaves us with \Sexpr{nrow(s1)} rows. 
With OLS,  \Sexpr{table(s1[tee == 1, Tee])} individuals are repeatedly observed for \Sexpr{names(table(s1[tee == 1, Tee]))} times, respectively. With FD, \textsf{s1} is reduced to \Sexpr{nrow(ds1d)} rows after first-differencing with \Sexpr{table(ds1d[tee == 2, Tee])} individuals with repeatedly observed for \Sexpr{as.numeric(names(table(ds1d[tee == 2, Tee])))+1} times, respectively.
<<sc read data>>=
s1 <- readRDS(paste0(pathsaveHere, "RosterSchoolingAdminDataUsedForEstimation.rds"))
s2 <- readRDS(paste0(pathsaveHere, "RosterAugmentedSchoolingAdminDataUsedForEstimation.rds"))
s1 <- s1[!grepl("nnn", Spattern), ]
s1 <- s1[!grepl("1001", EnrollPattern), ]
table(s1[tee == 1, Spattern])
s1 <- cbind(s1, makeDummyFromFactor(s1[, sex]))
s2 <- cbind(s2, makeDummyFromFactor(s2[, sex]))
s1[, Enrolled := as.numeric(Enrolled)]
s2[, Enrolled := as.numeric(Enrolled)]
s1[, CumEffectiveRepayment := CumEffectiveRepayment/1000]
s2[, CumEffectiveRepayment := CumEffectiveRepayment/1000]
# NAs in Schooling
s1[is.na(Schooling) & Age_1 >= 5 & Age_1 <= 12, Schooling := "primary0512"]
s1[is.na(Schooling) & Age_1 >= 13 & Age_1 <= 15, Schooling := "junior1315"]
s1[is.na(Schooling) & Age_1 >= 16 & Age_1 <= 18, Schooling := "high1618"]
s2[is.na(Schooling) & Age_1 >= 5 & Age_1 <= 12, Schooling := "primary0512"]
s2[is.na(Schooling) & Age_1 >= 13 & Age_1 <= 15, Schooling := "junior1315"]
s2[is.na(Schooling) & Age_1 >= 16 & Age_1 <= 18, Schooling := "high1618"]
<<sc regressions, warning = F>>=
# individual level regressions
scOLS11 <- lm(Enrolled  ~ -1 + dummyTraditional + 
  dummyLarge + dummyLargeGrace +
  dummyCow, data = s1)
scOLS12 <- lm(Enrolled  ~ -1 + 
  Schooling*dummyLarge + 
  Schooling*dummyLargeGrace +
  Schooling*dummyCow + 
  Schooling:dummyFemale +
  #RMvalue.repay + RMvalue.NetSaving + RMOtherRepaid + 
  factor(Year), data = s1)
scOLS13 <- lm(Enrolled  ~ -1 +
  Schooling*dummyLarge + Schooling*dummyLargeGrace +
  Schooling*dummyCow + 
  Schooling:dummyFemale +
  Schooling:dummyLarge:dummyFemale + Schooling:dummyLargeGrace:dummyFemale +
  Schooling:dummyCow:dummyFemale + 
  HeadAge + HeadLiteracy +
  factor(Year), data = s1)
scOLS14 <- lm(Enrolled  ~ -1 +
  Schooling*dummyLarge + Schooling*dummyLargeGrace +
  Schooling*dummyCow + 
  Schooling:dummyFemale +
  Schooling:dummyLarge:dummyFemale + Schooling:dummyLargeGrace:dummyFemale +
  Schooling:dummyCow:dummyFemale + 
  RMvalue.repay + RMvalue.NetSaving + RMOtherRepaid + 
  HeadAge + HeadLiteracy +
  factor(Year), data = s1)
scOLS15 <- lm(Enrolled  ~ -1 +
  Schooling*dummyLarge + Schooling*dummyLargeGrace +
  Schooling*dummyCow + 
  Schooling:dummyFemale +
  Schooling:dummyLarge:dummyFemale + Schooling:dummyLargeGrace:dummyFemale +
  Schooling:dummyCow:dummyFemale + 
  FloodInRd1 +
  HeadAge + HeadLiteracy +
  factor(Year), data = s1)
scOLS21 <- lm(Enrolled  ~ -1 + dummyTraditional + 
  dummyLarge + dummyLargeGrace +
  dummyCow, data = s2)
scOLS22 <- lm(Enrolled  ~ -1 + 
  Schooling*dummyLarge + Schooling*dummyLargeGrace +
  Schooling*dummyCow + 
  Schooling:dummyFemale +
  factor(Year), data = s2)
scOLS23 <- lm(Enrolled  ~ -1 + 
  Schooling*dummyLarge + Schooling*dummyLargeGrace +
  Schooling*dummyCow + 
  Schooling:dummyFemale +
  Schooling:dummyLarge:dummyFemale + Schooling:dummyLargeGrace:dummyFemale +
  Schooling:dummyCow:dummyFemale + 
  HeadAge + HeadLiteracy +
  factor(Year), data = s2)
scOLS24 <- lm(Enrolled  ~ -1 + 
  Schooling*dummyLarge + Schooling*dummyLargeGrace +
  Schooling*dummyCow + 
  Schooling:dummyFemale +
  Schooling:dummyLarge:dummyFemale + Schooling:dummyLargeGrace:dummyFemale +
  Schooling:dummyCow:dummyFemale + 
  RMvalue.repay + RMvalue.NetSaving + RMOtherRepaid + 
  HeadAge + HeadLiteracy +
  factor(Year), data = s2)
scOLS25 <- lm(Enrolled  ~ -1 + 
  Schooling*dummyLarge + Schooling*dummyLargeGrace +
  Schooling*dummyCow + 
  Schooling:dummyFemale +
  Schooling:dummyLarge:dummyFemale + Schooling:dummyLargeGrace:dummyFemale +
  Schooling:dummyCow:dummyFemale + 
  FloodInRd1 +
  HeadAge + HeadLiteracy +
  factor(Year), data = s2)
#s1[, Schooling := factor(Schooling, levels = c("junior1315", "high1618", "primary0512"))]
#s2[, Schooling := factor(Schooling, levels = c("junior1315", "high1618", "primary0512"))]
scOLS31 <- lm(Enrolled  ~ -1 + 
  dummySmallSize + dummyLargeSize, data = s1)
scOLS32 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyLargeSize +
  factor(Year), data = s1)
scOLS33 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyLargeSize + 
  Schooling:dummyFemale +
  Schooling:dummyLargeSize:dummyFemale + 
  factor(Year), data = s1)
scOLS34 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyLargeSize + 
  Schooling:dummyFemale +
  Schooling:dummyLargeSize:dummyFemale + 
  HeadAge + HeadLiteracy +
  RMvalue.repay + RMvalue.NetSaving + RMOtherRepaid + 
  factor(Year), data = s1)
scOLS35 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyLargeSize + 
  Schooling:dummyFemale +
  Schooling:dummyLargeSize:dummyFemale + 
  HeadAge + HeadLiteracy +
  FloodInRd1 +
  factor(Year), data = s1)
scOLS36 <- lm(Enrolled  ~ -1 + 
  dummySmallSize + dummyLargeSize, data = s2)
scOLS37 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyLargeSize +
  factor(Year), data = s2)
scOLS38 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyLargeSize + 
  Schooling:dummyFemale +
  Schooling:dummyLargeSize:dummyFemale + 
  HeadAge + HeadLiteracy +
  factor(Year), data = s2)
scOLS39 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyLargeSize + 
  Schooling:dummyFemale +
  Schooling:dummyLargeSize:dummyFemale + 
  HeadAge + HeadLiteracy +
  RMvalue.repay + RMvalue.NetSaving + RMOtherRepaid + 
  HeadAge + HeadLiteracy +
  factor(Year), data = s2)
scOLS40 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyLargeSize + 
  Schooling:dummyFemale +
  Schooling:dummyLargeSize:dummyFemale + 
  HeadAge + HeadLiteracy +
  FloodInRd1 +
  HeadAge + HeadLiteracy +
  factor(Year), data = s2)

scOLS41 <- lm(Enrolled  ~ -1 + dummyWithoutGrace + 
  dummyWithGrace, data = s1)
scOLS42 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyWithGrace + 
  factor(Year), data = s1)
scOLS43 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyWithGrace + 
  Schooling:dummyFemale +
  Schooling:dummyWithGrace:dummyFemale +
  HeadAge + HeadLiteracy +
  factor(Year), data = s1)
scOLS44 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyWithGrace + 
  Schooling:dummyFemale +
  Schooling:dummyWithGrace:dummyFemale +
  RMvalue.repay + RMvalue.NetSaving + RMOtherRepaid + 
  HeadAge + HeadLiteracy +
  factor(Year), data = s1)
scOLS45 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyWithGrace + 
  Schooling:dummyFemale +
  Schooling:dummyWithGrace:dummyFemale +
  FloodInRd1 +
  HeadAge + HeadLiteracy +
  factor(Year), data = s1)
scOLS46 <- lm(Enrolled  ~ -1 + dummyWithoutGrace + 
  dummyWithGrace, data = s2)
scOLS47 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyWithGrace + 
  HeadAge + HeadLiteracy +
  factor(Year), data = s2)
scOLS48 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyWithGrace + 
  Schooling:dummyFemale +
  Schooling:dummyWithGrace:dummyFemale +
  HeadAge + HeadLiteracy +
  factor(Year), data = s2)
scOLS49 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyWithGrace + 
  Schooling:dummyFemale +
  Schooling:dummyWithGrace:dummyFemale +
  RMvalue.repay + RMvalue.NetSaving + RMOtherRepaid + 
  HeadAge + HeadLiteracy +
  factor(Year), data = s2)
scOLS50 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyWithGrace + 
  Schooling:dummyFemale +
  Schooling:dummyWithGrace:dummyFemale +
  FloodInRd1 +
  HeadAge + HeadLiteracy +
  factor(Year), data = s2)

scp1 <- lm(Enrolled  ~ -1 + dummyUltraPoor + dummyModeratelyPoor, 
   data = s1)
scp2 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyUltraPoor +
  factor(Year), data = s1)
scp3 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyUltraPoor + 
  Schooling:dummyFemale +
  Schooling:dummyUltraPoor:dummyFemale + 
  HeadAge + HeadLiteracy +
  factor(Year), data = s1)
scp4 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyUltraPoor + 
  Schooling:dummyFemale +
  Schooling:dummyUltraPoor:dummyFemale + 
  RMvalue.repay + RMvalue.NetSaving + RMOtherRepaid + 
  HeadAge + HeadLiteracy +
  factor(Year), data = s1)
scp6 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyUltraPoor +
  factor(Year), data = s2)
scp7 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyUltraPoor + 
  Schooling:dummyFemale +
  Schooling:dummyUltraPoor:dummyFemale + 
  HeadAge + HeadLiteracy +
  factor(Year), data = s2)
scp8 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyUltraPoor + 
  Schooling:dummyFemale +
  Schooling:dummyUltraPoor:dummyFemale + 
  RMvalue.repay + RMvalue.NetSaving + RMOtherRepaid + 
  HeadAge + HeadLiteracy +
  factor(Year), data = s2)
scp9 <- lm(Enrolled  ~ -1 + 
  Schooling + Schooling:dummyUltraPoor + 
  Schooling:dummyFemale +
  Schooling:dummyUltraPoor:dummyFemale + 
  FloodInRd1 +
  RMvalue.repay + RMvalue.NetSaving + RMOtherRepaid + 
  HeadAge + HeadLiteracy +
  factor(Year), data = s2)
<<tabulate schooling OLS results>>=
# scXlist <- list(
#   matrix(s1[, groupid]),
#   matrix(s1[, groupid]),
#   matrix(s1[-scOLS13$na.action, groupid]),
#   matrix(s1[-scOLS14$na.action, groupid]),
#   matrix(s1[-scOLS15$na.action, groupid]),
#   matrix(s2[, groupid]),
#   matrix(s2[-scOLS22$na.action, groupid]),
#   matrix(s2[-scOLS23$na.action, groupid]),
#   matrix(s2[-scOLS24$na.action, groupid]),
#   matrix(s2[-scOLS25$na.action, groupid]))
sclist <- list(
  scOLS11, scOLS12, scOLS13, scOLS14, scOLS15, 
  scOLS21, scOLS22, scOLS23, scOLS24, scOLS25)
DataObjNames <- rep(c("s1", "s2"), each = 5)
reglists.header <- c("sc")
for (i in 1:length(reglists.header)) {
  ro.list <- get(paste0(reglists.header[i], "list"))
  ro <- lapply(1:length(ro.list), function(j) {
        datx <- get(DataObjNames[j])
        if (any(grepl("na.action", attributes(ro.list[[j]])$names)))
          clx(ro.list[[j]], cluster = datx[-ro.list[[j]]$na.action, groupid],  
             returnV = T, deviation = F) else
          clx(ro.list[[j]], cluster = datx[, groupid],  
             returnV = T, deviation = F)
       }
     )
  ro.estlist <- lapply(ro, "[[", 1)
  assign(paste0(reglists.header[i], ".estlist"), 
    lapply(ro.estlist, function(x) x[, -3, drop = F]))
  assign(paste0(reglists.header[i], ".N"), unlist(lapply(ro, "[[", 8)))
  assign(paste0(reglists.header[i], ".M"), unlist(lapply(ro, "[[", 6)))
  assign(paste0(reglists.header[i], ".R"), 
    unlist(lapply(ro.list, function(x) round(summary(x)$adj, 3))))
}
#unique(unlist(lapply(sc.estlist, rownames)))
#sc.tab <- tabs2latex3(sc.estlist, roworder = "^Sch.*[0-9]$|^sexFemale$|^Arm.*[^l][^e]$")
sc.tab <- tabs2latex3(sc.estlist)
rn <- rownames(sc.tab)
for (i in 1:nrow(subst.table)) 
  rn <- gsub(subst.table[i, 1], subst.table[i, 2], rn)
rn <- paste0("\\makebox[3cm]{\\scriptsize\\hfill ", rn, "}")
sc.tb <- rbind(as.matrix(cbind(covariates = rn, sc.tab)), 
  c("\\makebox[3cm]{\\scriptsize\\hfill number of clusters}", sc.M),
  c("\\bar{R}^{2}", sc.R),
  c("N", sc.N))
# omit year effects
sc.tb <- sc.tb[-(rep(grep("Year2", sc.tb[, "covariates"]), each = 2) + 0:1), ]
sc.ltxtb <- latextab(sc.tb, 
  hleft = "\\scriptsize\\hfil$", hcenter = c(4, rep(1.1, ncol(sc.tb)-1)), hright = "$", 
  headercolor = "gray80", adjustlineskip = "-.6ex", delimiterline= NULL,
  alternatecolor2 = "gray90",
  addseparatingcols = 5, separatingcolwidth = .2, 
  addsubcoltitlehere = T,
  separatingcoltitle = c("original data", "augmented data"))
write.tablev(sc.ltxtb, 
  paste0(pathsaveHere, "SchoolingOLSEstimationResults.tex"), colnamestrue = F)

scOLS2Xlist <- list(
  matrix(s1[, groupid]),
  matrix(s1[, groupid]),
  matrix(s1[, groupid]),
  matrix(s1[-scOLS34$na.action, groupid]),
  matrix(s1[-scOLS35$na.action, groupid]),
  matrix(s2[, groupid]),
  matrix(s2[-scOLS37$na.action, groupid]),
  matrix(s2[-scOLS38$na.action, groupid]),
  matrix(s2[-scOLS39$na.action, groupid]),
  matrix(s2[-scOLS40$na.action, groupid]))
scOLS2list <- list(
  scOLS31, scOLS32, scOLS33, scOLS34, scOLS35, 
  scOLS36, scOLS37, scOLS38, scOLS39, scOLS40)
DataObjNames <- rep(c("s1", "s2"), each = 5)
reglists.header <- c("scOLS2")
for (i in 1:length(reglists.header)) {
  ro.list <- get(paste0(reglists.header[i], "list"))
  ro <- lapply(1:length(ro.list), function(j) {
        datx <- get(DataObjNames[j])
        if (any(grepl("na.action", attributes(ro.list[[j]])$names)))
          clx(ro.list[[j]], cluster = datx[-ro.list[[j]]$na.action, groupid],  
             returnV = T, deviation = F) else
          clx(ro.list[[j]], cluster = datx[, groupid],  
             returnV = T, deviation = F)
        })
  ro.estlist <- lapply(ro, "[[", 1)
  assign(paste0(reglists.header[i], ".estlist"), 
    lapply(ro.estlist, function(x) x[, -3, drop = F]))
  assign(paste0(reglists.header[i], ".N"), unlist(lapply(ro, "[[", 8)))
  assign(paste0(reglists.header[i], ".M"), unlist(lapply(ro, "[[", 6)))
  assign(paste0(reglists.header[i], ".R"), 
    unlist(lapply(ro.list, function(x) round(summary(x)$adj, 3))))
}
#scOLS2.tab <- tabs2latex3(scOLS2.estlist)
scOLS2.tab <- tabs2latex3(scOLS2.estlist, roworder = 
paste0("^dummyS.*Size$|^dummyL.*Size$|^dummyW.*Grace$|^Sch.*[0-9]$|",
  "^dummyFemale$|^Sch.*[0-9].dummyFemale$|",
  "^Sch.*[0-9].dummyLargeSize$|^Sch.*LargeSize.*ale$|^Sch.*ale.*SmallSize$|",
  "^Sch.*[0-9].dummyWithGrace$|^Sch.*Gr.*ale$|^Sch.*Fem.*ace$"))
rn <- rownames(scOLS2.tab)
for (i in 1:nrow(subst.table)) 
  rn <- gsub(subst.table[i, 1], subst.table[i, 2], rn)
rn <- paste0("\\makebox[3cm]{\\scriptsize\\hfill ", rn, "}")
scOLS2.tb <- rbind(as.matrix(cbind(covariates = rn, scOLS2.tab)), 
  c("\\makebox[3cm]{\\scriptsize\\hfill number of clusters}", scOLS2.M),
  c("\\bar{R}^{2}", scOLS2.R),
  c("N", scOLS2.N))
# omit year effects
scOLS2.tb <- scOLS2.tb[-(rep(grep("Year2", scOLS2.tb[, "covariates"]), each = 2) + 0:1), ]
scOLS2.ltxtb <- latextab(scOLS2.tb, 
  hleft = "\\scriptsize\\hfil$", hcenter = c(4, 1.1, 1.2, rep(1.10, ncol(scOLS2.tb)-3)), hright = "$", 
  headercolor = "gray80",, adjustlineskip = "-.6ex", delimiterline= NULL,
  alternatecolor2 = "gray90",
  addseparatingcols = 5, separatingcolwidth = .2, 
  separatingcoltitle = c("original data", "augmented data"))
# scOLS2.ltxtb <- rbind(scOLS2.ltxtb[1:2, , drop = F], 
#   "\\multicolumn{12}{c}{}\\\\[-.5ex]",
#   "\\makebox[3cm]{\\scriptsize\\hfil } & \\multicolumn{5}{c}{\\scriptsize\\hfil s1} & & \\multicolumn{5}{c}{\\scriptsize\\hfil s2 (Augmented data)}\\\\",
#   "\\cline{2-6} \\cline{8-12}\\\\",
#   scOLS2.ltxtb[-(1:2), , drop = F])
write.tablev(scOLS2.ltxtb, 
  paste0(pathsaveHere, "SchoolingOLSEstimationResults2.tex"), colnamestrue = F)

scOLS4Xlist <- list(
  matrix(s1[, groupid]),
  matrix(s1[, groupid]),
  matrix(s1[-scOLS43$na.action, groupid]),
  matrix(s1[-scOLS44$na.action, groupid]),
  matrix(s1[-scOLS45$na.action, groupid]),
  matrix(s2[, groupid]),
  matrix(s2[-scOLS47$na.action, groupid]),
  matrix(s2[-scOLS48$na.action, groupid]),
  matrix(s2[-scOLS49$na.action, groupid]),
  matrix(s2[-scOLS50$na.action, groupid]))
scOLS4list <- list(
  scOLS41, scOLS42, scOLS43, scOLS44, scOLS45, 
  scOLS46, scOLS47, scOLS48, scOLS49, scOLS50)
DataObjNames <- rep(c("s1", "s2"), each = 5)
reglists.header <- c("scOLS4")
for (i in 1:length(reglists.header)) {
  ro.list <- get(paste0(reglists.header[i], "list"))
  ro <- lapply(1:length(ro.list), function(j) {
        datx <- get(DataObjNames[j])
        if (any(grepl("na.action", attributes(ro.list[[j]])$names)))
          clx(ro.list[[j]], cluster = datx[-ro.list[[j]]$na.action, groupid],  
             returnV = T, deviation = F) else
          clx(ro.list[[j]], cluster = datx[, groupid],  
             returnV = T, deviation = F)
        })
  ro.estlist <- lapply(ro, "[[", 1)
  assign(paste0(reglists.header[i], ".estlist"), 
    lapply(ro.estlist, function(x) x[, -3, drop = F]))
  assign(paste0(reglists.header[i], ".N"), unlist(lapply(ro, "[[", 8)))
  assign(paste0(reglists.header[i], ".M"), unlist(lapply(ro, "[[", 6)))
  assign(paste0(reglists.header[i], ".R"), 
    unlist(lapply(ro.list, function(x) round(summary(x)$adj, 3))))
}
scOLS4.tab <- tabs2latex3(scOLS4.estlist, roworder = 
paste0("^dummyS.*Size$|^dummyL.*Size$|^dummyW.*Grace$|^Sch.*[0-9]$|",
  "^dummyFemale$|^Sch.*[0-9].dummyFemale$|",
  "^Sch.*[0-9].dummyLargeSize$|^Sch.*LargeSize.*ale$|^Sch.*ale.*SmallSize$|",
  "^Sch.*[0-9].dummyWithGrace$|^Sch.*Gr.*ale$|^Sch.*Fem.*ace$"))
rn <- rownames(scOLS4.tab)
for (i in 1:nrow(subst.table)) 
  rn <- gsub(subst.table[i, 1], subst.table[i, 2], rn)
rn <- paste0("\\makebox[3cm]{\\scriptsize\\hfill ", rn, "}")
scOLS4.tb <- rbind(as.matrix(cbind(covariates = rn, scOLS4.tab)), 
  c("\\makebox[3cm]{\\scriptsize\\hfill number of clusters}", scOLS4.M),
  c("\\bar{R}^{2}", scOLS4.R),
  c("N", scOLS4.N))
# omit year effects
scOLS4.tb <- scOLS4.tb[-(rep(grep("Year2", scOLS4.tb[, "covariates"]), each = 2) + 0:1), ]
scOLS4.ltxtb <- latextab(scOLS4.tb, 
  hleft = "\\scriptsize\\hfil$", hcenter = c(4, 1.1, 1.2, rep(1.10, ncol(scOLS4.tb)-3)), hright = "$", 
  headercolor = "gray80",, adjustlineskip = "-.6ex", delimiterline= NULL,
  alternatecolor2 = "gray90",
  addseparatingcols = 5, separatingcolwidth = .2, 
  separatingcoltitle = c("original data", "augmented data"))
write.tablev(scOLS4.ltxtb, 
  paste0(pathsaveHere, "SchoolingOLSEstimationResults3.tex"), colnamestrue = F)

scpXlist <- list(
  matrix(s1[, groupid]),
  matrix(s1[, groupid]),
  matrix(s1[-scp3$na.action, groupid]),
  matrix(s2[-scp6$na.action, groupid]),
  matrix(s2[-scp7$na.action, groupid]),
  matrix(s2[-scp8$na.action, groupid]),
  matrix(s2[-scp9$na.action, groupid]))
scplist <- list(scp1, scp2, scp3, scp6, scp7, scp8, scp9)
DataObjNames <- c(rep("s1", 3), rep("s2", 4))
reglists.header <- c("scp")
for (i in 1:length(reglists.header)) {
  ro.list <- get(paste0(reglists.header[i], "list"))
  ro <- lapply(1:length(ro.list), function(j) {
        datx <- get(DataObjNames[j])
        if (any(grepl("na.action", attributes(ro.list[[j]])$names)))
          clx(ro.list[[j]], cluster = datx[-ro.list[[j]]$na.action, groupid],  
             returnV = T, deviation = F) else
          clx(ro.list[[j]], cluster = datx[, groupid],  
             returnV = T, deviation = F)
        })
  ro.estlist <- lapply(ro, "[[", 1)
  assign(paste0(reglists.header[i], ".estlist"), lapply(ro.estlist, function(x) x[, -3, drop = F]))
  assign(paste0(reglists.header[i], ".N"), unlist(lapply(ro, "[[", 8)))
  assign(paste0(reglists.header[i], ".M"), unlist(lapply(ro, "[[", 6)))
  assign(paste0(reglists.header[i], ".R"), unlist(lapply(ro.list, function(x) round(summary(x)$adj, 3))))
}
scp.tab <- tabs2latex3(scp.estlist)
rn <- rownames(scp.tab)
for (i in 1:nrow(subst.table)) 
  rn <- gsub(subst.table[i, 1], subst.table[i, 2], rn)
rn <- paste0("\\makebox[3cm]{\\scriptsize\\hfill ", rn, "}")
scp.tb <- rbind(as.matrix(cbind(covariates = rn, scp.tab)), 
  c("\\makebox[3cm]{\\scriptsize\\hfill number of clusters}", scp.M),
  c("\\bar{R}^{2}", scp.R),
  c("N", scp.N))
# omit year effects
scp.tb <- scp.tb[-(rep(grep("Year2", scp.tb[, "covariates"]), each = 2) + 0:1), ]
scp.ltxtb <- latextab(scp.tb, 
  hleft = "\\scriptsize\\hfil$", hcenter = c(4, rep(1.10, ncol(scp.tb)-1)), hright = "$", 
  headercolor = "gray80",, adjustlineskip = "-.6ex", delimiterline= NULL,
  alternatecolor2 = "gray90",
  addseparatingcols = 3, separatingcolwidth = .2, 
    separatingcoltitle = c("original data", "augmented data"))
write.tablev(scp.ltxtb, 
  paste0(pathsaveHere, "SchoolingOLSEstimationPovertystatusResults.tex"), colnamestrue = F)
@
<<dummy chunk 1>>=
# dummy chunk
@


\hspace{-1.5cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: OLS estimation of school enrollment\label{tab ols school}}\\
\setlength{\tabcolsep}{.5pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.50}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "SchoolingOLSEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & Intercept terms are omitted in estimating equations. Year effects are included in estimation (not shown). \textsf{s1} is complete portion of panel. \textsf{s2} is a panel data augmenting attrited members in \textsf{s1} with an assumption that they are out of school unless it is explicitly stated as attending school by family members. Number of observations decreases in (2) relative to (1) because of NAs in \textsf{Schooling} (because \textsf{Age\_1} is missing) erroneous entries in calendar \textsf{Year} in \textsf{IntDate} which result in NAs. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

Check number of observations in each cell:
<<check number of obs in schooling ols>>=
scDatalist <- list(
  s1,
  s1,
  s1[-scOLS13$na.action, ],
  s1[-scOLS14$na.action, ],
  s1[-scOLS15$na.action, ],
  s2,
  s2[-scOLS22$na.action, ],
  s2[-scOLS23$na.action, ],
  s2[-scOLS24$na.action, ],
  s2[-scOLS25$na.action, ])
scOLS2Datalist <- list(
  s1,
  s1,
  s1,
  s1[-scOLS34$na.action, ],
  s1[-scOLS35$na.action, ],
  s2,
  s2[-scOLS37$na.action, ],
  s2[-scOLS38$na.action, ],
  s2[-scOLS39$na.action, ],
  s2[-scOLS40$na.action, ])
scOLS4Datalist <- list(
  s1,
  s1,
  s1[-scOLS43$na.action, ],
  s1[-scOLS44$na.action, ],
  s1[-scOLS45$na.action, ],
  s2,
  s2[-scOLS47$na.action, ],
  s2[-scOLS48$na.action, ],
  s2[-scOLS49$na.action, ],
  s2[-scOLS50$na.action, ]
)
<<Interaction between 2 matrices., warning = F>>=
eks <- s1[-scOLS14$na.action, ]
# x <- matrix(rep(c(1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0), 10000), ncol = 10)
# y <- matrix(rep(c(1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0), 50000), ncol = 50)
# z <- matrix(rep(c(1, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1), 20000), ncol = 20)
# colnames(x) <- paste0("x", 1:10)
# colnames(y) <- paste0("y", 1:50)
# colnames(z) <- paste0("z", 1:20)
# XYZ is faster than XYZ2
#rbind(system.time(interactXYZ(x, y, z)),
#  system.time(interactXYZ2(x, y, z)))
x <- matrix(rep(c(1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2), 1), ncol = 2)
y <- matrix(rep(c(1, 0, 1, 0, 1, 0, 2, 0, 2, 0, 2, 0)*2, 1), ncol = 2)
z <- matrix(rep(c(1, 1, 0, 0, 1, 1, 2, 2, 0, 0, 2, 2)*3, 1), ncol = 2)
colnames(x) <- paste0("x", 1:2)
colnames(y) <- paste0("y", 1:2)
colnames(z) <- paste0("z", 1:2)
if (!is.data.table(x)) x <- data.table(x)
if (!is.data.table(y)) y <- data.table(y)
if (!is.data.table(z)) z <- data.table(z)
xy <- interactXY(x, y)
xd <- scDatalist[[1]]
x <- makeDummyFromFactor(xd[, Arm], NULL) 
y <- makeDummyFromFactor(xd[, Schooling], NULL)
z <- makeDummyFromFactor(xd[, sex], NULL)
#x[, grepout("Dr", colnames(x)) := NULL]
w <- interactXYZ(y, x, z)
s1 <- s1[, which(unlist(lapply(s1, function(x) !all(is.na(x))))), with=F]
#nrow(xd[grepl("cow", Arm) & grepl("hi", Schooling) & grepl("F", sex), 
#  .(hhid, mid, survey, Age_1, Attrit)])
#lapply(InTerms, function(x)
#  Reduce(cbind, lapply(1:ncol(x), function(i) 
#    matrix(as.numeric(unlist(x[, .(sum(x[[i]]), nrow(x))]))))))
<<tabulating number of obs in schooling ols, warning = F>>=
InTerms <- lapply(scDatalist, function(x) 
  interactXYZ(
    makeDummyFromFactor(x[, Arm], NULL), 
    makeDummyFromFactor(x[, sex], NULL),
    makeDummyFromFactor(x[, Schooling], NULL)
    ))
InTerms <- rbindlist(lapply(InTerms, function(x) {
  z <- data.table(t(c(nrow(x), unlist(lapply(1:ncol(x), function(i) sum(x[, i, with = F]))))))
  setnames(z, gsub(" ", "", gsub("dummy", "", c("total", colnames(x)))))
  z
}))
InTerms <- InTerms[, which(unlist(lapply(InTerms, function(x) !all(is.na(x) | x == 0)))), with=F]
InTerms <- t(InTerms)
colnames(InTerms) <- paste0("(", 1:ncol(InTerms), ")") 
InTerms <- InTerms[c(grep("Tra", rownames(InTerms)), 
  grep("Large[^g]", rownames(InTerms)),
  grep("Largeg", rownames(InTerms)),
  grep("Cow", rownames(InTerms)),
  grep("total", rownames(InTerms))
  ), ]
# reorder within a group
rn.j <- rownames(InTerms)
newroworder <- NULL
for (j in c("Tra", "Large[^g]", "Largeg", "Cow"))
  newroworder <- c(newroworder, 
    c(grep(paste0(j, ".*ale$"), rn.j), grep(paste0(j, ".*P"), rn.j), 
      grep(paste0(j, ".*J"), rn.j), grep(paste0(j, ".*H"), rn.j)))
InTerms <- InTerms[c(newroworder, nrow(InTerms)), ]
rn0 <- paste0("\\makebox[3cm]{\\scriptsize\\hfill ", rownames(InTerms), "}")
rn0 <- gsub("\\_", " $\\\\times$ ", rn0)
rn <- gsub("Traditional|Large|Largegrace|Cow", "", rn0)
IntT.tb <- as.matrix(cbind(" " = rn, InTerms))
IntT.ltxtb <- latextab(IntT.tb, 
  hleft = c("\\scriptsize$", rep("\\scriptsize\\hfil$", ncol(IntT.tb) - 1)), 
  hcenter = c(3, rep(0.8, ncol(IntT.tb) - 1)), hright = "$", 
  headercolor = "gray80", #adjustlineskip = "-.6ex", 
  #adjlskiprows = c(1:2, 4, 6, 8, c(1:2, 4, 6, 8)+9, c(1:2, 4, 6, 8)+9*2, c(1:2, 4, 6, 8)+9*3),
  delimiterline= NULL,
  addseparatingcols = 5, separatingcolwidth = .2, 
  separatingcoltitle = c("original data", "augmented data"))
# IntTtb <- rbind(IntT.ltxtb[1:2, , drop = F], 
#   "\\multicolumn{12}{c}{}\\\\[-.5ex]",
#   "\\makebox[3cm]{\\scriptsize } & \\multicolumn{5}{c}{\\scriptsize\\hfil s1} & & \\multicolumn{5}{c}{\\scriptsize\\hfil s2 (Augmented data)}\\\\",
#   "\\cline{2-6} \\cline{8-12}\\\\",
#   "\\makebox[3cm]{\\scriptsize Traditional\\hfill} & \\multicolumn{11}{c}{}\\\\",
#   IntT.ltxtb[1:max(grep("Tra", rn0))+2, , drop = F],
#   "\\makebox[3cm]{\\scriptsize Large\\hfill} & \\multicolumn{11}{c}{}\\\\",
#   IntT.ltxtb[min(grep("Large[^g]", rn0)):(min(grep("Largeg", rn0) - 1)) + 2, , drop = F],
#   "\\makebox[3cm]{\\scriptsize Large grace\\hfill} & \\multicolumn{11}{c}{}\\\\",
#   IntT.ltxtb[min(grep("Largeg", rn0)):(min(grep("Cow", rn0)) - 1) + 2, , drop = F],
#   "\\makebox[3cm]{\\scriptsize Cow\\hfill} & \\multicolumn{11}{c}{}\\\\",
#   IntT.ltxtb[(min(grep("Cow", rn0))+2):(nrow(IntT.ltxtb) -2), , drop = F],
#   "\\multicolumn{12}{c}{}\\\\[-.5ex]",
#   IntT.ltxtb[(min(grep("total", rn0))+2):nrow(IntT.ltxtb), , drop = F]
#   )
write.tablev(IntT.ltxtb, 
  paste0(pathsaveHere, "NumObsSchoolingOLS.tex"), colnamestrue = F)
@
<<tabulating number of obs in schooling ols by Size, warning = F>>=
# Size
InTerms2 <- lapply(scOLS2Datalist, function(x) 
  interactXYZ(
    makeDummyFromFactor(x[, Size], NULL), 
    makeDummyFromFactor(x[, sex], NULL),
    makeDummyFromFactor(x[, Schooling], NULL)
    ))
InTerms4 <- lapply(scOLS4Datalist, function(x) 
  interactXYZ(
    makeDummyFromFactor(x[, Grace], NULL), 
    makeDummyFromFactor(x[, sex], NULL),
    makeDummyFromFactor(x[, Schooling], NULL)
    ))
InTerms2 <- rbindlist(lapply(InTerms2, function(x) {
  z <- data.table(t(c(nrow(x), unlist(lapply(1:ncol(x), function(i) sum(x[, i, with = F]))))))
  setnames(z, gsub(" ", "", gsub("dummy", "", c("total", colnames(x)))))
  z
}))
InTerms4 <- rbindlist(lapply(InTerms4, function(x) {
  z <- data.table(t(c(nrow(x), unlist(lapply(1:ncol(x), function(i) sum(x[, i, with = F]))))))
  setnames(z, gsub(" ", "", gsub("dummy", "", c("total", colnames(x)))))
  z
}))
InTerms2 <- InTerms2[, which(unlist(lapply(InTerms2, function(x) !all(is.na(x) | x == 0)))), with=F]
InTerms4 <- InTerms4[, which(unlist(lapply(InTerms4, function(x) !all(is.na(x) | x == 0)))), with=F]
InTerms2 <- t(InTerms2)
InTerms4 <- t(InTerms4)
colnames(InTerms2) <- paste0("(", 1:ncol(InTerms2), ")") 
colnames(InTerms4) <- paste0("(", 1:ncol(InTerms4), ")") 
InTerms2 <- InTerms2[c(grep("SmallS", rownames(InTerms2)), 
  grep("LargeS", rownames(InTerms2)),
  grep("total", rownames(InTerms2))
  ), ]
InTerms4 <- InTerms4[c(grep("Witho", rownames(InTerms4)), 
  grep("WithG", rownames(InTerms4)),
  grep("total", rownames(InTerms4))
  ), ]
# reorder within a group
rn.j21 <- rownames(InTerms2)
rn.j22 <- rownames(InTerms4)
newroworder2 <- newroworder4 <- NULL
for (j in c("SmallS", "LargeS"))
  newroworder2 <- c(newroworder2, 
    c(grep(paste0(j, ".*ale$"), rn.j21), grep(paste0(j, ".*P"), rn.j21), 
      grep(paste0(j, ".*J"), rn.j21), grep(paste0(j, ".*H"), rn.j21)))
for (j in c("Witho", "WithG"))
  newroworder4 <- c(newroworder4, 
    c(grep(paste0(j, ".*ale$"), rn.j22), grep(paste0(j, ".*P"), rn.j22), 
      grep(paste0(j, ".*J"), rn.j22), grep(paste0(j, ".*H"), rn.j22)))
InTerms2 <- InTerms2[c(newroworder2, nrow(InTerms2)), ]
InTerms4 <- InTerms4[c(newroworder4, nrow(InTerms4)), ]
rn0 <- paste0("\\makebox[3cm]{\\scriptsize\\hfill ", rownames(InTerms2), "}")
rn0 <- gsub("\\_", " $\\\\times$ ", rn0)
rn <- gsub("SmallSize|LargeSize", "", rn0)
IntT2.tb <- as.matrix(cbind(" " = rn, InTerms2))
IntT2.ltxtb <- latextab(IntT2.tb, 
  hleft = c("\\scriptsize$", rep("\\scriptsize\\hfill$", ncol(IntT2.tb) - 1)), 
  hcenter = c(3, rep(0.8, ncol(IntT2.tb) - 1)), hright = "$", 
  headercolor = "gray80",, 
  delimiterline= NULL)
IntT2tb <- rbind(IntT2.ltxtb[1:2, , drop = F], 
  "\\makebox[3cm]{\\scriptsize Small Size\\hfill} & \\multicolumn{4}{c}{}\\\\",
  IntT2.ltxtb[1:max(grep("SmallS", rn0))+2, , drop = F],
  "\\makebox[3cm]{\\scriptsize Large Size\\hfill} & \\multicolumn{4}{c}{}\\\\",
  IntT2.ltxtb[(min(grep("LargeS", rn0)) + 2):(nrow(IntT2.ltxtb) -2), , drop = F],
  "\\multicolumn{5}{c}{}\\\\[-.5ex]",
  IntT2.ltxtb[(min(grep("total", rn0))+2):nrow(IntT2.ltxtb), , drop = F]
  )
rn0 <- paste0("\\makebox[3cm]{\\scriptsize\\hfill ", rownames(InTerms4), "}")
rn0 <- gsub("\\_", " $\\\\times$ ", rn0)
rn <- gsub("WithoutGrace|WithGrace", "", rn0)
IntT4.tb <- as.matrix(cbind(" " = rn, InTerms4))
IntT4.ltxtb <- latextab(IntT4.tb, 
  hleft = c("\\scriptsize$", rep("\\scriptsize\\hfill$", ncol(IntT4.tb) - 1)), 
  hcenter = c(3, rep(0.8, ncol(IntT4.tb) - 1)), hright = "$", 
  headercolor = "gray80",
  delimiterline= NULL)
IntT4tb <- rbind(IntT4.ltxtb[1:2, , drop = F], 
  "\\makebox[3cm]{\\scriptsize No Grace\\hfill} & \\multicolumn{4}{c}{}\\\\",
  IntT4.ltxtb[1:max(grep("Witho", rn0))+2, , drop = F],
  "\\makebox[3cm]{\\scriptsize Grace\\hfill} & \\multicolumn{4}{c}{}\\\\",
  IntT4.ltxtb[(min(grep("WithG", rn0) + 2)):(nrow(IntT4.ltxtb) -2), , drop = F],
  "\\multicolumn{5}{c}{}\\\\[-.5ex]",
  IntT4.ltxtb[(min(grep("total", rn0))+2):nrow(IntT4.ltxtb), , drop = F]
  )
write.tablev(IntT2tb, 
  paste0(pathsaveHere, "NumObsSchoolingOLS2.tex"), colnamestrue = F)
write.tablev(IntT4tb, 
  paste0(pathsaveHere, "NumObsSchoolingOLS4.tex"), colnamestrue = F)
<<dummy chunk 2>>=
#dummy chunk
@

\hspace{-1.0cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: Number of observations in each cells of schooling regression in Table \ref{tab ols school}\label{tab num obs ols school}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.45}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "NumObsSchoolingOLS.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize GUK administrative and survey data.}\\
Notes: & 1. &  Original data is schooling panel data with attrition. Augmented data is original data plus imputed values of schooling for attrited individuals. \\
& 2. & %${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1.5cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: OLS estimation of school enrollment, different grouping\label{tab ols school2}}\\
\setlength{\tabcolsep}{.5pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "SchoolingOLSEstimationResults2.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & Intercept terms are omitted in estimating equations. Year effects are included in estimation (not shown). \textsf{s1} is complete portion of panel. \textsf{s2} is a panel data augmenting attrited members in \textsf{s1} with an assumption that they are out of school unless it is explicitly stated as attending school by family members. \textsf{SmallSize} includes \textsf{Traditional}, \textsf{LargeSize} includes \textsf{Large, Large grace, Cow}. \textsf{WithoutGrace} includes \textsf{Traditional, Large}, \textsf{WithGrace} includes \textsf{Large grace, cow}.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}


\hspace{-1.5cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: OLS estimation of school enrollment, small vs. large sized \label{tab ols school3}}\\
\setlength{\tabcolsep}{.5pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "SchoolingOLSEstimationResults3.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & Intercept terms are omitted in estimating equations. Year effects are included in estimation (not shown). \textsf{s1} is complete portion of panel. \textsf{s2} is a panel data augmenting attrited members in \textsf{s1} with an assumption that they are out of school unless it is explicitly stated as attending school by family members. \textsf{SmallSize} includes \textsf{Traditional}, \textsf{LargeSize} includes \textsf{Large, Large grace, Cow}. \textsf{WithoutGrace} includes \textsf{Traditional, Large}, \textsf{WithGrace} includes \textsf{Large grace, cow}.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: Number of observations in each cells of schooling regression in Table \ref{tab ols school2}, \ref{tab ols school3}\label{tab num obs ols school3}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.45}
\hfil\begin{tikzpicture}
\node (tbl) {
\input{\Sexpr{paste0(pathsaveHere, "NumObsSchoolingOLS2.tex")}}};
\end{tikzpicture}\\

\hfil\begin{tikzpicture}
\node (tbl2) {
\input{\Sexpr{paste0(pathsaveHere, "NumObsSchoolingOLS4.tex")}}};
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize GUK administrative and survey data.}\\
Notes: & 1. &  \\
& 2. & %${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}


\hspace{-1.5cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: OLS estimation of school enrollment, ultra poor vs. moderately poor\label{tab ols school4}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "SchoolingOLSEstimationPovertystatusResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & Intercept terms are omitted in estimating equations. Year effects are included in estimation (not shown). \textsf{s1} is complete portion of panel. \textsf{s2} is a panel data augmenting attrited members in \textsf{s1} with an assumption that they are out of school unless it is explicitly stated as attending school by family members. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\begin{palepinkleftbar}
\begin{finding}
\textit{The following does not apply to first-difference estimation.} \sout{\textsc{\small Table \ref{tab ols school}} shows school enrollment is higher for \textsf{s1} than \textsf{s2}, indicating nonattriting members are school goers. When using \textsf{s1} data, \textsf{cow} and \textsf{large grace} show negative impacts for older children, yet not for girls in junior high schools. In fact, (1) shows that girles in high school have higher enrollment in \textsf{s1} and both junior and high schools for \textsf{s2} in (4). This may be due to increased labour demand within a family for boys. Similar patterns are found in \textsf{s2} data, yet not statistically significant, probably because data augmentation introduces more school dropouts among older girls. In \textsc{\small Table \ref{tab ols school2}} when using with grace/without grace grouping, the pattern becomes statistically significant for both \textsf{s1} and \textsf{s2}. Large size vs. small size contrast has smaller statistical power that more subtle outcomes cannot be detected. No difference between ultra and moderately poor is found in \textsc{\small Table \ref{tab ols school4}}.} In first-difference estimation, rd 1 and rd 4 comparison of \textsc{\normalsize Table \ref{tab FD enroll5}} (2) - (4) show a marginally statistically significant higher enrollment rates for girls of \textsf{Cow}. 
\end{finding}
\end{palepinkleftbar}


<<ReadTrimSchoolingFDData2, cache = F, child='c:/data/GUK/analysis/program/ReadTrimSchoolingFDData2.rnw'>>=
@
If using \textsf{s1}, retain only the complete portion of panel. \textsf{sch1} has \Sexpr{nrow(s01)} rows. Drop \Sexpr{nrow(s01[grepl("nnn", Spattern), ])} observations in \textsf{sch1} with nnn in \textsf{Spattern} and \Sexpr{nrow(s01[!grepl("nnn", Spattern) & grepl("1001", EnrollPattern), ])} observations with 1001 in \textsf{EnrollPattern} because they are likely to be errors. This leaves us with \Sexpr{nrow(s1)} rows. 
<<schooling FD read data>>=
s.1 <- s01[!grepl("nnn", Spattern), ]
s.1 <- s.1[!grepl("1001", EnrollPattern), ]
s.1[, Enrolled := as.numeric(Enrolled)]
s02[, Enrolled := as.numeric(Enrolled)]
s.2 = copy(s02)
ds1d[, Tee := .N, by = HHMid]
@
With OLS,  \Sexpr{table(s.1[tee == 1, Tee])} individuals are repeatedly observed for \Sexpr{names(table(s.1[tee == 1, Tee]))} times, respectively. With FD, \textsf{s1} is reduced to \Sexpr{nrow(ds1d)} rows after first-differencing with \Sexpr{table(ds1d[tee == 2, Tee])} individuals with repeatedly observed for \Sexpr{as.numeric(names(table(ds1d[tee == 2, Tee])))+1} times, respectively.
Individuals with NAs in \textsf{Schooling}. Mostly older children (\Sexpr{round(mean(s.1[is.na(Schooling), Age_1]), 1)} in \textsf{s1}, \Sexpr{round(mean(s.2[is.na(Schooling), Age_1]), 1)} in \textsf{s.2}) but with a high reported enrollment rate (\Sexpr{round(mean(s.1[is.na(Schooling) & tee == 4, Enrolled]), 1)} for \textsf{s1}, \Sexpr{round(mean(s.2[is.na(Schooling) & tee == 4, Enrolled]), 1)} for \textsf{s.2}) at rd 4. We will substitute relevant schooling levels to \textsf{Schooling}.
<<tabulate dummyPrimary>>=
table(apply(s1[, .(dummyPrimary, dummyJunior, dummyHigh)], 1, sum))
table(apply(s1[, .(dummyTraditional, dummyLarge, dummyLargeGrace, dummyCow)], 1, sum))
ds1d[, grepout("^Tee$", colnames(ds1d)) := NULL]
@
An example of dummy interactions: \textsf{\footnotesize \Sexpr{tobeintSchdumTimdum}}.
Obs for \textsf{s1}.
<<Obs for s1>>=
table(ds1d[, tee])
@
Obs for \textsf{s1} and admin repayment data.
<<Obs for s1 and admin repayment data>>=
table(ds1Rd[, tee])
table(ds2Rd[, tee])
@
Obs for survey \textsf{s2}.
<<Obs for survey s2>>=
table(ds2d[, tee])
@
Obs for survey \textsf{s2} and admin repayment data.
<<Obs for survey s2 and admin repayment data>>=
table(ds2Rd[, tee])
#ds1Rd <- ds1Rd[tee > 2, ]
#ds2d <- ds2d[tee > 2, ]
#ds2Rd <- ds2Rd[tee > 2, ]
<<schooling FD select covariates, echo = T>>=
arsuffixes <- c("", "g", "p", "s")
source(paste0(pathprogram, "SchoolingCovariateSelection.R"))
<<schooling FD estimation, warning = F, results = 'hide'>>=
#FileNameHeader <- paste0(FileNameHeaderRepayment, "OriginalHHs")
FileNameHeaderSchooling <- c("", "Grace", "PovertyStatus", "Size", 
  "TInt", "TIntGrace", "TIntSize", "Rd14Diff", "Rd14DiffGrace")
FileNameHeader <- FileNameHeaderSchooling
DataToUse1 <- c(rep("ds1d", 4), rep("ds2d", 3))
DataToUse2 <- c(rep("ds134d", 4), rep("ds234d", 3))
source(paste0(pathprogram, "FDEstimationSchooling.R"))
@

<<schooling FD estimation previous, eval = F>>=
Scsuffixes <- c("", "g", "p", "s", "T", "Tg", "Ts", "D", "Dg")
listheader <- paste0("sc", Scsuffixes)
exclheader <- paste0("excl", Scsuffixes)
FileNameHeader <- c("", "Grace", "PovertyStatus", "Size", 
  "TInt", "TIntGrace", "TIntSize", "Rd14Diff", "Rd14DiffGrace")
Regressands <- rep("Enrolled", 7)
for (k in 1:length(listheader)) {
  if (k >= 5 & k <= 7) 
    CovariateBoxSize <- 5 else 
    CovariateBoxSize <- 3.5
  if (k < 8) 
    DataToUse <- DataToUse1 else
    DataToUse <- DataToUse2
  # Estimate
  for (j in 1:7)
    assign(paste0(listheader[k], j),
      FDestimation(get(DataToUse[j]), Regressand = Regressands[j], 
        Group = "^HHMid$", TimeVar = "tee", Cluster = "groupid", 
        Exclude = paste(get(paste0(exclheader[k], ".base")), 
          get(paste0(exclheader[k], ".", j)), sep = "|"),
        intercept = T, return.V = T, print.messages = T)
    )
  # Format and save
  sclist <- eval(parse(text = 
    paste("list(", paste(listheader[k], 1:7, sep = "", collapse = ", "), ")")))
  sc.estlist <- lapply(sclist, "[[", "est")
  sc.estlist <- lapply(sc.estlist, function(x) x[, -3, drop = F])
  sc.N <- unlist(lapply(sclist, "[[", "N"))
  if (k < 7) {
    ttab <- lapply(sclist, "[[", "ActualTTable")
    ttab <- rbindlist(lapply(ttab, function(x) data.table(as.data.frame.matrix(t(x)))), use.names = T, fill = T)
    setcolorder(ttab, c("1", "2", "3"))
    ttab <- a2b.data.table(ttab, NA, 0)
    sc.T <- cbind(c("T = 2", "T = 3", "T = 4"), t(ttab))
  } else sc.T <- NULL
  sc.R <- unlist(lapply(lapply(lapply(sclist, "[[", "nonrobust"), summary), "[[", "adj.r.squared"))
  sc.tab <- tabs2latex3(sc.estlist, digits = 2)
  rn <- rownames(sc.tab)
  thisEsttab <- sc.tab
  # reorder rows: rn.new
  source(paste0(pathprogram, "ReorderingOfRowsInEstimatedResultsTable.R"))
  rn <- rn[rn.new]
  sc.tab <- sc.tab[rn.new, ]
  for (i in 1:nrow(subst.table)) 
    rn <- gsub(subst.table[i, 1], subst.table[i, 2], rn)
  rn <- paste0("\\makebox[", CovariateBoxSize, "cm]{\\scriptsize\\hfill ", rn, "}")
  sc.tb <- rbind(as.matrix(cbind(covariates = rn, sc.tab)), 
    sc.T,
    c("\\bar{R}^{2}", round(sc.R, 3)),
    c("N", sc.N))
  if (k == which(grepl("^T$", Scsuffixes))) {
  # table with time interaction is too long so split into 2 tables
    sc.ltxtb1 <- latextab(sc.tb[1:(grep("hfill rd 2 - 3}$", rn)-1), ], 
      hleft = "\\scriptsize\\hfil$", hcenter = c(CovariateBoxSize, rep(1.1, ncol(sc.tb)-1)), 
      hright = "$", headercolor = "gray80", adjustlineskip = "-.6ex", 
      delimiterline= NULL, alternatecolor2 = "gray90", 
      addseparatingcols = 4, separatingcolwidth = .2,
      separatingcoltitle = c("original data", "augmented data"))
    sc.ltxtb2 <- latextab(sc.tb[-(1:(grep("hfill rd 2 - 3}$", rn)-1)), ], 
      hleft = "\\scriptsize\\hfil$", hcenter = c(CovariateBoxSize, rep(1.1, ncol(sc.tb)-1)), 
      hright = "$", headercolor = "gray80", adjustlineskip = "-.6ex", 
      delimiterline= NULL, alternatecolor2 = "gray90", 
      addseparatingcols = 4, separatingcolwidth = .2, 
      separatingcoltitle = c("original data", "augmented data"))
#     sc.ltxtb1 <- rbind(sc.ltxtb1[1:2, , drop = F], 
#       "\\multicolumn{9}{c}{}\\\\[-.5ex]",
#       paste0("\\makebox[", CovariateBoxSize, "cm]{\\scriptsize\\hfil } & \\multicolumn{4}{c}{\\scriptsize\\hfil sc1} & & \\multicolumn{3}{c}{\\scriptsize\\hfil sc2}\\\\"),
#       "\\cline{2-5} \\cline{7-9}\\\\",
#       sc.ltxtb1[-(1:2), , drop = F])
#     sc.ltxtb2 <- rbind(sc.ltxtb2[1:2, , drop = F], 
#       "\\multicolumn{9}{c}{}\\\\[-.5ex]",
#       paste0("\\makebox[", CovariateBoxSize, "cm]{\\scriptsize\\hfil } & \\multicolumn{4}{c}{\\scriptsize\\hfil sc1} & & \\multicolumn{3}{c}{\\scriptsize\\hfil sc2}\\\\"),
#       "\\cline{2-5} \\cline{7-9}\\\\",
#       sc.ltxtb2[-(1:2), , drop = F])
    write.tablev(sc.ltxtb1, 
      paste0(pathsaveHere, "Schooling", FileNameHeader[k], "FDEstimationResults1.tex"), 
      colnamestrue = F)
    write.tablev(sc.ltxtb2, 
      paste0(pathsaveHere, "Schooling", FileNameHeader[k], "FDEstimationResults2.tex"), 
      colnamestrue = F)
  } else {
    sc.ltxtb <- latextab(sc.tb, 
      hleft = "\\scriptsize\\hfil$", hcenter = c(CovariateBoxSize, rep(1.1, ncol(sc.tb)-1)), 
      hright = "$", headercolor = "gray80", adjustlineskip = "-.6ex", 
      delimiterline= NULL, alternatecolor2 = "gray90", 
      addseparatingcols = 4, separatingcolwidth = .2,
      separatingcoltitle = c("original data", "augmented data"))
    write.tablev(sc.ltxtb, 
      paste0(pathsaveHere, "Schooling", FileNameHeader[k], "FDEstimationResults.tex"), 
      colnamestrue = F)
  }
}
<<dummy chunk 3>>=
#dummy chunk
@

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of school enrollment\label{tab FD enroll}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.48}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "SchoolingFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. First-differenced regressands are regressed on categorical and time-variant covariates. Net saving is taken from administrative data and merged with survey data at Year-Month of survey interviews. Head age and literacy are from baseline data. Intercept terms are omitted in estimating equations. Net saving is saving - withdrawal. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of net school enrollment, ultra poor vs. moderately poor\label{tab FD enroll2}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "SchoolingPovertystatusFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. First-differenced regressands are regressed on categorical and time-variant covariates. Net saving is taken from administrative data and merged with survey data at Year-Month of survey interviews. Head age and literacy are from baseline data. Intercept terms are omitted in estimating equations. Net saving is saving - withdrawal. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of school enrollment, with vs. without a grace period\label{tab FD enroll3}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "SchoolingGraceFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. First-differenced regressands are regressed on categorical and time-variant covariates. Net saving is taken from administrative data and merged with survey data at Year-Month of survey interviews. Head age and literacy are from baseline data. Intercept terms are omitted in estimating equations. Net saving is saving - withdrawal. All dummy interaction terms are first demeaned and then interacted.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of school enrollment, small size vs. large size\label{tab FD enroll4}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "SchoolingSizeFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. First-differenced regressands are regressed on categorical and time-variant covariates. Net saving is taken from administrative data and merged with survey data at Year-Month of survey interviews. Head age and literacy are from baseline data. Intercept terms are omitted in estimating equations. Net saving is saving - withdrawal. All dummy interaction terms are first demeaned and then interacted.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}


\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of school enrollment, round 1 vs. round 4 differences\label{tab FD enroll5}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "SchoolingRd14DiffFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. First-differenced regressands are regressed on categorical and time-variant covariates. Net saving is taken from administrative data and merged with survey data at Year-Month of survey interviews. Head age and literacy are from baseline data. Intercept terms are omitted in estimating equations. Net saving is saving - withdrawal. All dummy interaction terms are first demeaned and then interacted.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}


\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of school enrollment, round 1 vs. round 4 differences, grace period\label{tab FD enroll6 14}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "SchoolingRd14DiffGraceFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. First-differenced regressands are regressed on categorical and time-variant covariates. Net saving is taken from administrative data and merged with survey data at Year-Month of survey interviews. Head age and literacy are from baseline data. Intercept terms are omitted in estimating equations. Net saving is saving - withdrawal. All dummy interaction terms are first demeaned and then interacted.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}


\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of school enrollment, period interactions\label{tab FD enroll6}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.45}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "SchoolingTIntFDEstimationResults1.tex")}}};
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. First-differenced regressands are regressed on categorical and time-variant covariates. Net saving is taken from administrative data and merged with survey data at Year-Month of survey interviews. Head age and literacy are from baseline data. Intercept terms are omitted in estimating equations. Net saving is saving - withdrawal. All dummy interaction terms are first demeaned and then interacted.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \ref{tab FD enroll6}: FD estimation of school enrollment, period interactions, continued \label{tab FD enroll6c}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.45}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "SchoolingTIntFDEstimationResults2.tex")}}};
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. First-differenced regressands are regressed on categorical and time-variant covariates. Net saving is taken from administrative data and merged with survey data at Year-Month of survey interviews. Head age and literacy are from baseline data. Intercept terms are omitted in estimating equations. Net saving is saving - withdrawal. All dummy interaction terms are first demeaned and then interacted.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of school enrollment, period interactions, grace period\label{tab FD enroll7}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.5}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "SchoolingTIntGraceFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. First-differenced regressands are regressed on categorical and time-variant covariates. Net saving is taken from administrative data and merged with survey data at Year-Month of survey interviews. Head age and literacy are from baseline data. Intercept terms are omitted in estimating equations. Net saving is saving - withdrawal. All dummy interaction terms are first demeaned and then interacted.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}


\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of school enrollment, period interactions, small vs. large sized loans\label{tab FD enroll8}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.5}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "SchoolingTIntSizeFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. First-differenced regressands are regressed on categorical and time-variant covariates. Net saving is taken from administrative data and merged with survey data at Year-Month of survey interviews. Head age and literacy are from baseline data. Intercept terms are omitted in estimating equations. Net saving is saving - withdrawal. All dummy interaction terms are first demeaned and then interacted.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}


\subsection{Repayment and net saving}

<<ReadTrimRepaymentFDData, cache = F, child='c:/data/GUK/analysis/program/ReadTrimRepaymentFDData.rnw'>>=
@
Repayment started in round 2. So taking a first-difference leaves us with period 2-3 and period 3-4. Drop \Sexpr{nrow(dar2[tee <= 2, ])} observations in \textsf{ar} that have round 1 data (for unknown reasons). After first-differencing, \textsf{ar} has \Sexpr{nrow(dar2[tee>2, ])} rows with \Sexpr{table(dar2[tee > 2, Tee])} individuals with repeatedly observed for \Sexpr{as.numeric(names(table(dar2[tee>2, Tee])))+1} times, respectively. \Sexpr{table(dar2[tee > 2, Tee])["3"]} individuals observed for 4 times started repayment even before official disbursement date, so its round 1 will be dropped.

Plot repayment by date. (Simple plotting does not work because repayment is ighly erratic.)
<<Fig Cumulative weekly net saving, warning = F, message = F, eval = T, fig.align='center', fig.height = 3, fig.width = 10, fig.cap = paste0("Cumulative weekly net saving", ""), fig.lp = 'Figure '>>=
library(ggplot2)
adw2 <- readRDS(paste0(path1234, "admin_data_wide2.rds"))
YAxis1 <- c(0, 10, 50, 100, 500, 1000) 
linedata <- data.table(Arm = factor(levels(adw2[, Arm]), 
  levels = levels(adw2[, Arm])), value = c(125, 125, 190, 190), 
  Variable = factor(rep("NormRepaid", 4)))
g <- ggplot(adw2[!is.na(Date), .(Arm, Date = as.Date(Date), value.repay)], 
  aes(x = Date, y = 1+value.repay, colour = Arm, group = Arm)) +
  geom_point(aes(colour = Arm), size = .1, position = position_dodge(width = .5)) +
  geom_smooth(data = adw2[!is.na(Date) & value.repay > 0, .(Arm, Date = as.Date(Date), value.repay)], 
    span = .5, aes(colour = Arm, group = Arm)) +
  theme(legend.position="none", legend.key = element_rect(fill = "white"),
    axis.text.x=element_text(angle=90, hjust=1)) + 
  scale_y_log10(limits = c(1, 2000), breaks = YAxis1 + 1, labels = YAxis1) +
  scale_x_date(date_breaks = "6 month", date_labels = "%m-%Y") +
  geom_hline(data = linedata, aes(yintercept = value), colour = "black", size = .3) +
  xlab("Date") + ylab("Net saving amount") +
  facet_grid(. ~ Arm, scales = "free_y")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "CumulativeWeeklyNetSaving.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
<<monthly normalised repayment, warning = F, message = F, fig.align='center', fig.height = 3, fig.width = 10, fig.cap = "Normalised weekly repayment by date, members receiving loans by Nov, 2014", fig.lp = 'Figure '>>=
adw2 <- readRDS(paste0(path1234, "admin_data_wide2.rds"))
adl1 <- adw2[grepl("Yes", creditstatus) & !is.na(MonthsElapsed) & 
  as.Date(DisDate1) <= as.Date("2015-01-01"), 
  .(hhid, groupid, povertystatus, Arm, Date = as.Date(Date), MonthsElapsed, 
    OutstandingRate, NormRepaid, CumRepaid, FullyRepaid, CumRepaidRate)]
adl1[OutstandingRate <= 0 & NormRepaid == 0, NormRepaid := NA]
setnames(adl1, c("NormRepaid", "FullyRepaid", "CumRepaidRate"),
  paste0("value.", c("NormRepaid", "FullyRepaid", "CumRepaidRate")))
adl1 <- reshape(adl1, direction = "long", idvar = c("hhid", "MonthsElapsed", "Date"),
  varying = grepout("^val", colnames(adl1)))
setnames(adl1, "time", "Variable")
adl1 <- adl1[grepl("NormRepaid", Variable) & value > 0, ]
adl1[, value := log(value)]
linedata <- data.table(Arm = factor(levels(adl1[, Arm]), 
  levels = levels(adl1[, Arm])), value = c(log(c(125, 125, 190, 190)), rep(.25, 4)), 
  Variable = factor(rep(c("NormRepaid", "NonRepayerRatioEM"), each = 4), 
    levels = c("NormRepaid", "NonRepayerRatioEM")))
linedata <- linedata[grepl("Nor", Variable), ]
YAxis1 <- c(.25, .5, .75, 1)
YAxis2 <- c(10, 30, 40, 60, 90, 125, 190, 500, 1000, 2000, 3000)
YAxisValues <- c(YAxis1, YAxis2)
YAxisLabels <- c(YAxis1, YAxis2)
g <- ggplot(adl1, aes(x = Date, y = value, colour = povertystatus, group = hhid)) +
  geom_line(data = subset(adl1, Variable == "NormRepaid", group = hhid), 
    aes(colour = povertystatus), size = .1) +
  geom_smooth(data = subset(adl1, Variable == "NormRepaid"), 
    span = .5, aes(colour = povertystatus, group = povertystatus)) +
  theme(legend.position="bottom", 
    axis.text.x=element_text(angle=90, hjust=1),
    legend.key = element_rect(fill = "white")) + 
  scale_y_continuous(breaks = log(YAxis2), labels = YAxis2, limits = range(log(YAxis2))) +
  scale_x_date(date_breaks = "6 month", date_labels = "%m-%Y") +
  geom_hline(data = linedata, aes(yintercept = value), colour = "green", size = .3) +
  xlab("Months since 1st loan disbursement") + ylab("Rolling-averaged repaid amount") +
  facet_grid(. ~ Arm, scales = "free_y")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "CumulativeWeeklyNormalisedRepayment.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
@
Mean group repayment shortfall shows members, on average, repay by the end of 3rd year.
<<repayment shortfall by group, warning = F, message = F, fig.align='center', fig.height = 4, fig.width = 10, fig.cap = paste0("Repayment shortfall by group", "\\\\ {\\footnotesize Dots indicate group means. Dots are jittered to avoid plot overlap. Observations below -2000 Tk shortfall are omitted. Shortfall is defined as a difference between planned and actual installments. Planned installment is zero after 36 months, so negative entries indicate continuing installments for overdued loans. Mean group shortfall is per member shortfall in a group. \\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
adw2 <- readRDS(paste0(path1234, "admin_data_wide2.rds"))
setkey(adw2, hhid, MonthsElapsed)
adl5 <- adw2[grepl("Yes", creditstatus) & !is.na(MonthsElapsed) & 
  !grepl("doub|tw", TradGroup) & as.Date(DisDate1) <= as.Date("2015-01-01"), 
 .(hhid, groupid, povertystatus, Shortfall, value.NetSaving, CumRepaid,
   Arm, Date, LoanYear, MonthsElapsed)]
adl5[, c("GroupShortfall", "Gnum") := .(mean(Shortfall), 1:.N), 
  by = .(groupid, povertystatus, MonthsElapsed)]
adg <- adl5[Gnum == 1, ]
adg[, c("Shortfall", "hhid") := NULL]
grlinedata <- adg[MonthsElapsed > 36, .(Arm, groupid, MonthsElapsed, GroupShortfall)]
grlinedata[, MeanShortfallPost36 := mean(GroupShortfall), by = Arm]
grlinedata <- unique(grlinedata[, .(Arm, MonthsElapsed, MeanShortfallPost36)])
g <- ggplot(adg, 
  aes(x = MonthsElapsed, y = GroupShortfall, colour = povertystatus, group = groupid)) +
  geom_point(aes(colour = povertystatus), size = .1, 
    position = position_jitterdodge(jitter.width = 5, jitter.height = 5)) +
  geom_smooth(data = adg[grepl("tr|ge$", Arm) & MonthsElapsed > 0 & MonthsElapsed <= 36, ], 
    span = .5, aes(colour = povertystatus, group = povertystatus)) +
  geom_smooth(data = adg[grepl("gr|cow", Arm) & MonthsElapsed > 12 & MonthsElapsed <= 36, ], 
    span = .5, aes(colour = povertystatus, group = povertystatus)) +
  #geom_line(data = grlinedata, 
  #  aes(x = MonthsElapsed, y = MeanShortfallPost36, group = Arm, colour = Arm)) +
  theme(legend.position="bottom", legend.key = element_rect(fill = "white")) + 
  scale_x_continuous(limits = c(-12, 46), breaks = seq(-12, 48, 12)) +
  scale_y_continuous(limits = c(-2000, 1000), breaks = c(-2000, seq(-1000, 1000, 250))) +
  ylab("Group repayment shortfall (Tk)") + 
  xlab("Months elapsed since initial loan disbursement") +
  facet_grid(. ~ Arm, scales = "free_y")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "RepaymentShortfallByGroup.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
@

\mpage{\linewidth}{
\hfil\textsc{\footnotesize Figure \refstepcounter{figure}\thefigure: Weekly net saving \label{fig netsaving}}\\
\hfil\includegraphics{\Sexpr{  paste0(pathprogram, "figure/ImpactEstimationMembership1or4/", "CumulativeWeeklyNetSaving.png")}}\\
\renewcommand{\arraystretch}{1}
\hfil\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source: & Administrative data.\\
Note:& \\[1ex]
\end{tabular}

\hfil\textsc{\footnotesize Figure \refstepcounter{figure}\thefigure: Normalised cumulative weekly repayment \label{fig repayment}}\\
\hfil\includegraphics{\Sexpr{  paste0(pathprogram, "figure/ImpactEstimationMembership1or4/", "CumulativeWeeklyNormalisedRepayment.png")}}\\
\renewcommand{\arraystretch}{1}
\hfil\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source: & Administrative data.\\
Note:& Weekly repayments are normalised by the number of weeks in each month. \\[1ex]
\end{tabular}
}


Note all binary interaction terms are demeaned and then interacted.
<<prepare data for saving regressions, warning = F, message = F>>=
ar <- readRDS(paste0(pathsaveHere, "RosterAdminDataUsedForEstimation.rds"))
ar[, Mid := 1:.N, by = .(hhid, survey)]
ar <- ar[Mid == 1, ]
ar[, Mid := NULL]
ar[, CumSave := CumNetSaving - CumRepaid]
ar[, CumEffectiveRepayment := CumNetSaving + CumRepaid]
ar[, Arm := droplevels(Arm)]
ar[, HeadLiteracy := HeadLiteracy + 0]
source("c:/migrate/R/startRbat/panel_estimator_functions.R")
setorder(ar, hhid, IntDate)
ar[, grepout("LoanY|^Time$", colnames(ar)) := NULL]
#ar[, c("dummyForcedDropOuts") := NULL]
@
NAs in \textsf{CumRepaid}.
<<NAs in CumRepaid>>=
table0(ar[is.na(CumRepaid), .(survey, Arm)])
@
Tabulation at rd 1:
<<Tabulation at rd 1>>=
table0(ar[survey == 1, .(Mstatus, RArm)])
<<Fig cumulative net saving, warning = F, message = F, fig.align='center', fig.height = 3, fig.width = 10, fig.cap = paste0("Cumulative weekly net saving", ""), fig.lp = 'Figure '>>=
library(ggplot2)
adw2 <- readRDS(paste0(path1234, "admin_data_wide2.rds"))
setkey(adw2, hhid, MonthsElapsed)
adl5 <- adw2[grepl("Yes", creditstatus) & !is.na(MonthsElapsed) & 
  !grepl("doub|tw", TradGroup) & as.Date(DisDate1) <= as.Date("2015-01-01"), 
 .(hhid, groupid, povertystatus, CumNetSaving, CumRepaid, Arm, Date, MonthsElapsed)]
g <- ggplot(adl5[!is.na(Date), .(Arm, hhid, Date, MonthsElapsed, CumNetSaving)], 
  aes(x = MonthsElapsed, y = CumNetSaving, colour = Arm, group = Arm)) +
  geom_point(aes(colour = Arm), size = .1, position = position_dodge(width = .5)) +
  geom_smooth(span = .5, aes(colour = "black", group = Arm)) +
  theme(legend.position="none", legend.key = element_rect(fill = "white")) + 
  scale_y_continuous() +
  scale_x_continuous(limits = c(-12, 48), breaks = seq(-12, 48, 12)) +
  xlab("Months since 1st loan disbursement") + ylab("Cumulative net saving amount") +
  facet_grid(. ~ Arm, scales = "free_y")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "CumulativeWeeklyNetSavingMonthsSinceDisbursement.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
<<Fig cumulative repayment, warning = F, message = F, fig.align='center', fig.height = 3, fig.width = 10, fig.cap = paste0("Cumulative weekly repayment", ""), fig.lp = 'Figure '>>=
library(ggplot2)
grlinedata <- data.table(MonthsElapsed = -12:48, 
  TotalDebt.traditional = 125*MonthsOfRepayment*3,
  TotalDebt.large = 125*MonthsOfRepayment*3,
  TotalDebt.largegrace = 190*MonthsOfRepayment*2,
  TotalDebt.cow = 190*MonthsOfRepayment*2)
grlinedata <- reshape(grlinedata, direction = "long", idvar = "MonthsElapsed",
  varying = grepout("Tot", colnames(grlinedata)))
grlinedata[, time := gsub("largeg", "large g", time)]
grlinedata[, Arm := factor(time, levels = levels(adl5[,Arm]))]
g <- ggplot(adl5[!is.na(Date), .(Arm, hhid, Date, MonthsElapsed, CumRepaid)], 
  aes(x = MonthsElapsed, y = CumRepaid, colour = Arm, group = Arm)) +
  geom_point(aes(colour = Arm), size = .1, position = position_dodge(width = .5)) +
  geom_smooth(span = .5, aes(colour = "black", group = Arm)) +
  theme(legend.position="none", legend.key = element_rect(fill = "white")) + 
  scale_y_continuous() +
  scale_x_continuous(limits = c(-12, 48), breaks = seq(-12, 48, 12)) +
  geom_hline(data = grlinedata, aes(yintercept = TotalDebt), colour = "green", size = .3) +
  xlab("Months since 1st loan disbursement") + ylab("Cumulative repayment amount") +
  facet_grid(. ~ Arm, scales = "free_y")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "CumulativeRepaymentMonthsSinceDisbursement.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
<<saving regressions estimation set parameters>>=
FileName <- "Saving"
FileNameHeader <- c("", "Grace", "PovertyStatus", "Size")
arsuffixes <- c("", "g", "p", "s")
listheader <- paste0("sv", arsuffixes)
Regressands <-  c(rep("CumNetSaving", 2), rep("CumRepaid", 3), 
  rep("CumEffectiveRepayment", 3))
DataToUse1 <- DataToUse2 <- rep("dar2", 8)
Addseparatingcols = c(2,5); Separatingcolwidth = rep(.2, 2)
Separatingcoltitle = c("Cumulative net saving", "Cumulative repayment", 
   "Cumulative net saving + cumulative repayment")
<<saving regresions select covariates, echo = F>>=
source(paste0(pathprogram, "RepaymentCovariateSelection.R"))
<<saving regressions estimation>>=
exclheader <- paste0("excl", arsuffixes)
source(paste0(pathprogram, "FDEstimationFile.R"))
<<check linear independence in saving data>>=
LinDependent <- function(z, ShowMostDependent = F, ReturnColNames = F) 
#  From CrossVal: https://stats.stackexchange.com/questions/16327/testing-for-linear-dependence-among-the-columns-of-a-matrix#39321
#  The weakness of this function is that it does not specify which columns are jointly linearly dependent.
#  ShowMostDependent: if T, returns column that is least linearly independent, if F, returns columns that are linearly dependent.
{
  if (!is.matrix(z)) z <- as.matrix(z)
  rankofz <- qr(z)$rank
  if (rankofz == ncol(z)) message("Full rank.") else
  {
    rankifremoved <- sapply(1:ncol(z), function (x) qr(z[, -x])$rank)
    if (ReturnColNames) {
      if (ShowMostDependent)
        this <- colnames(z)[rankifremoved == max(rankifremoved)] else
        this <- colnames(z)[rankifremoved == ncol(z) - 1] 
    } else {
      if (!ShowMostDependent)
        this <- which(rankifremoved == max(rankifremoved)) else
        this <- which(rankifremoved == ncol(z) - 1)
    }
    return(this)
  }
}
# svX <- as.matrix(sv12$data[, .(
#   Time.2, dummyLarge.Time2,
#   dummyLargeGrace.Time2, dummyCow.Time2, 
#   Time.3 , dummyLarge.Time3 ,
#   dummyLargeGrace.Time3 , dummyCow.Time3 , 
#   Time.4 , dummyLarge.Time4 ,
#   dummyLargeGrace.Time4, dummyCow.Time4 )])
#LinDependent(svX, F, T) 
<<get arsv data used in sv regressions>>=
arsv <- ar[, .(Arm, groupid, hhid, tee = as.factor(tee))]
svDatalist <- list(arsv, arsv, arsv, arsv, arsv, arsv, arsv, arsv)
<<tabulating number of obs in sv ols, warning = F>>=
InTermsSV <- lapply(svDatalist, function(x) 
  interactXY(
    makeDummyFromFactor(x[, Arm], NULL), 
    makeDummyFromFactor(x[, tee], NULL)
    ))
InTermsSV <- rbindlist(lapply(InTermsSV, function(x) {
  z <- data.table(t(c(nrow(x), unlist(lapply(1:ncol(x), function(i) sum(x[, i, with = F]))))))
  setnames(z, gsub(" ", "", gsub("dummy", "", c("total", colnames(x)))))
  z
}))
InTermsSV <- InTermsSV[, which(unlist(lapply(InTermsSV, function(x) !all(is.na(x) | x == 0)))), with=F]
InTermsSV <- t(InTermsSV)
colnames(InTermsSV) <- paste0("(", 1:ncol(InTermsSV), ")") 
InTermsSV <- InTermsSV[c(grep("Tra", rownames(InTermsSV)), 
  grep("Large[^g]", rownames(InTermsSV)),
  grep("Largeg", rownames(InTermsSV)),
  grep("Cow", rownames(InTermsSV)),
  grep("total", rownames(InTermsSV))
  ), ]
# reorder within a group
rn.j <- rownames(InTermsSV)
newroworder <- NULL
for (j in c("Tra", "Large[^g]", "Largeg", "Cow"))
  newroworder <- c(newroworder, 
    c(grep(paste0(j, ".*ale$"), rn.j), grep(paste0(j, ".*P"), rn.j), 
      grep(paste0(j, ".*J"), rn.j), grep(paste0(j, ".*H"), rn.j)))
InTermsSV <- InTermsSV[c(newroworder, nrow(InTermsSV)), ]
<<dummy chunk 4>>=
#dummy chunk
@


\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of cumulative net saving and repayment\label{tab FD saving}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "Saving", FileNameHeader[1], "FDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates using rd 2 - rd 4 data. First-differenced ($\Delta x_{t+1}\equiv x_{t+1} - x_{t}$) regressands are regressed on categorical and time-variant covariates. Net saving is taken from administrative data and merged with survey data at Year-Month of survey interviews. Head age and literacy are from baseline data. Intercept terms are omitted in estimating equations. Net saving is saving - withdrawal. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of net cumulative saving and repayment, ultra poor vs. moderately poor\label{tab FD saving2}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "Saving", FileNameHeader[3], "FDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates using rd 2 - rd 4 data. First-differenced ($\Delta x_{t+1}\equiv x_{t+1} - x_{t}$) regressands are regressed on categorical and time-variant covariates. Net saving is taken from administrative data and merged with survey data at Year-Month of survey interviews. Head age and literacy are from baseline data. Intercept terms are omitted in estimating equations. Net saving is saving - withdrawal. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of net cumulative saving and repayment, with vs. without a grace period\label{tab FD saving3}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "Saving", FileNameHeader[2], "FDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates using rd 2 - rd 4 data. First-differenced ($\Delta x_{t+1}\equiv x_{t+1} - x_{t}$) regressands are regressed on categorical and time-variant covariates. Net saving is taken from administrative data and merged with survey data at Year-Month of survey interviews. Head age and literacy are from baseline data. Intercept terms are omitted in estimating equations. Net saving is saving - withdrawal. All dummy interaction terms are first demeaned and then interacted.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of net cumulative saving and repayment, small size vs. large size\label{tab FD saving4}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "Saving", FileNameHeader[4], "FDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates using rd 2 - rd 4 data. First-differenced ($\Delta x_{t+1}\equiv x_{t+1} - x_{t}$) regressands are regressed on categorical and time-variant covariates. Net saving is taken from administrative data and merged with survey data at Year-Month of survey interviews. Head age and literacy are from baseline data. Intercept terms are omitted in estimating equations. Net saving is saving - withdrawal. All dummy interaction terms are first demeaned and then interacted.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}


\begin{palepinkleftbar}
\begin{finding}
\textsc{\small Table \ref{tab FD saving}} (1) shows net saving increases, (2) shows that initially a larger then a smaller extent in the later rounds. This reduction may reflect the use of saving for repayment. \textsf{traditional} arm has the lowest repayment rates. Ultra poor and moderately poor have similar repayment rates as indicated in \textsc{\small Table \ref{tab FD saving2}}. \textsc{Table \ref{tab FD saving3}} (2) shows having a grace period increases the repayment amount while reduces net saving in later rounds. (4) and (5) show cumulative repayment is greater for with grace because each installment is larger. These are all by design that they do not repay in rd 1 so saving increases then they tap in these saving for repayment. 
\end{finding}
\end{palepinkleftbar}


\subsection{Assets}

Assets reportd in rd 1 is too small, indicating possible errors or different way of reporting only in rd 1. So we also examine rd 2 vs. rd 4 differences (\textsf{as3, as4}).

<<ReadTrimAssetFDData, cache = F, eval = F, warning = F, child='c:/data/GUK/analysis/program/ReadTrimAssetFDData.rnw'>>=
<<ReadTrimAssetFDData in R file>>=
source(paste0(pathprogram, "ReadTrimAssetFDData.R"))
@

Main assets are household assets (\textsf{HAssetAmount}) and production assets (\textsf{PAssetAmount}) both with \Sexpr{nrow(ass1[!is.na(HAssetAmount), ])} observations. After first-differencing, they become \Sexpr{nrow(das1d)} observations, with \Sexpr{table(das1d[, Tee])} households observed for \Sexpr{as.numeric(names(table(das1d[, Tee])))+1} times. We also examine rd 2 vs. rd 4 differences, which has \Sexpr{nrow(ass3[!is.na(HAssetAmount), ])} observations. After first-differencing, they become \Sexpr{nrow(das3d)} observations.

<<asset regression set parameters>>=
FileName <- "Asset"
FileNameHeader <- c("", "Grace", "PovertyStatus", "Size", "Rd24Diff", "Rd24Grace")
Assuffixes <- c("", "G", "P", "S", "D", "DG")
listheader <- paste0("as", Assuffixes)
DataToUse1 <- c(rep("das1d", 3), "das1Rd", rep("das2d", 3), "das2Rd")
DataToUse2 <- c(rep("das3d", 3), "das3Rd", rep("das4d", 3), "das4Rd")
Regressands <- c(rep("HAssetAmount", 4), rep("PAssetAmount", 4))
Addseparatingcols = 4; Separatingcolwidth = .2
Separatingcoltitle = c("Household asset amount (Tk)", "Productive asset amount (Tk)")
<<asset regression select covariates, echo = T>>=
source(paste0(pathprogram, "AssetCovariateSelection.R"))
<<asset regression estimation>>=
exclheader <- paste0("excl", Assuffixes)
source(paste0(pathprogram, "FDEstimationFile.R"))
<<asset regression select covariates robustness, echo = T>>=
# Compare asset changes between arms and "pure control" (loan nonreceivers)
source(paste0(pathprogram, "AssetCovariateSelectionRobustness.R"))
<<asset regression robustness>>=
FileNameHeader <- paste0(FileNameHeader, "Robustness")
exclheader <- paste0("excl", Assuffixes)
source(paste0(pathprogram, "FDEstimationFile.R"))
<<>>=
#dummy chunk
@

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of assets\label{tab FD assets}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "AssetFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+k}\equiv x_{t+k} - x_{t}$  for $k=1, 2, \dots$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Household assets do not include livestock. Regressions (1)-(3), (5)-(6) use only arm and calendar information. (4) and (7) use previous six month repayment and saving information which is lacking in rd 1, hence starts from rd 2.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of assets, moderately poor vs. ultra poor\label{tab FD assets2}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "AssetPovertyStatusFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+k}\equiv x_{t+k} - x_{t}$  for $k=1, 2, \dots$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Household assets do not include livestock. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of assets, small vs. large size loans\label{tab FD assets3}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "AssetSizeFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+k}\equiv x_{t+k} - x_{t}$  for $k=1, 2, \dots$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Household assets do not include livestock. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of assets, with vs. without a grace period\label{tab FD assets4}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "AssetGraceFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+k}\equiv x_{t+k} - x_{t}$  for $k=1, 2, \dots$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Household assets do not include livestock. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of assets, round 2 and 4 comparison\label{tab FD assets rd24}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "AssetRd24DiffFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates between round 2 and 4. A first-difference is defined as $\Delta x_{t+k}\equiv x_{t+k} - x_{t}$ for $k=1, 2, \dots$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Household assets do not include livestock. Regressions (1)-(3), (5)-(6) use only arm and calendar information. (4) and (7) use previous six month repayment and saving information which is lacking in rd 1, hence starts from rd 2.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of assets, round 2 and 4 comparison, grace period\label{tab FD assets rd24 grace}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "AssetRd24GraceFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates between round 2 and 4. A first-difference is defined as $\Delta x_{t+k}\equiv x_{t+k} - x_{t}$ for $k=1, 2, \dots$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Household assets do not include livestock. Regressions (1)-(3), (5)-(6) use only arm and calendar information. (4) and (7) use previous six month repayment and saving information which is lacking in rd 1, hence starts from rd 2.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}


Robustness: \textsc{\small Table \ref{tab FD assets pure control}} shows that the pure controls also experience similar increase-increase-decrease pattern. This suggests the pattern observed among the loan recipients may be a systemic pattern of the area, not necessarily reflecting the repayment burdern.

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of assets, loan recipients vs. pure control\label{tab FD assets pure control}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "Asset", FileNameHeader[1], "FDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates between round 2 and 4. A first-difference is defined as $\Delta x_{t+k}\equiv x_{t+k} - x_{t}$ for $k=1, 2, \dots$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Household assets do not include livestock. Regressions (1)-(3), (5)-(6) use only arm and calendar information. (4) and (7) use previous six month repayment and saving information which is lacking in rd 1, hence starts from rd 2. Pure controls are households who rejected to receive a loan.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}


\begin{palepinkleftbar}
\begin{finding}
\textsc{\small Table \ref{tab FD assets}} (1) shows household assets increase after receiving the loans in all arms. Total incremant is largest among the \textsf{large grace} arm as indicated in (2). In (3), increments are positive in rd 2 - 3, suggesting substantial purchase after receiving a loan. Significant decreases in rd 3 - 4 for all arms indicate liquidation of assets for repayment. Productive assets of large size loan arms decrease in rd 3 - 4 in \textsc{\small Table \ref{tab FD assets3}} (6). These may indicate forced liquidation for repayment, which can entail efficiency losses.
\end{finding}
\end{palepinkleftbar}



\subsection{Livestock}

\subsubsection{Livestock}

<<ReadTrimLivestockFDData, cache = F, eval = F, child='c:/data/GUK/analysis/program/ReadTrimLivestockFDData.rnw'>>=
@
<<ReadTrimLivestockFDData in R file, cache = F>>=
source(paste0(pathprogram, "ReadTrimLivestockFDData.R'))
@
An example FD estimation.
<<An example FD estimation for livestock holding>>=
lvo11 <- lvo[1:100, grepl("hhid|group|^tee|^Arm$|dummyWith|^Time|Head|TotalImp", colnames(lvo)), with = F]
  dl <- prepFDData(lvo11, Group = "^hhid$", TimeVar = "tee", Cluster = "groupid", 
    LevelCovariates = "^dummyW|^Arm$|Floo|^Time\\..$|Head", 
    drop.if.NA.in.differencing = T, LevelPeriodToKeep = "last",
    use.var.name.for.dummy.prefix = F, print.messages = F)
  dat <- dl$diff
summary(lm(TotalImputedValue ~ dummyWithGrace + 
  Time.2 + dummyWithGrace.Time2 + Time.3 + dummyWithGrace.Time3, data = dat))
@
%Estimates are negative on Time.2 and dummyWithGrace.Time2 because period 1-2 growth was very high so any growth in period 2-3 (Time.2) is reduction from it.
<<livestock regression estimation set parameters>>=
FileName <- "Livestock"
FileNameHeader <- c("", "Grace", "PovertyStatus", "Size", 
    "TInt", "TIntGrace", "TIntSize", "Rd14Diff", "Rd14DiffGrace")
Lvsuffixes <- c("", "G", "P", "S", "T", "TG", "TS", "D", "DG")
listheader <- paste0("lv", Lvsuffixes)
DataToUse1 <- rep("dlvod", 6)
DataToUse2 <- rep("dlvo3d", 6)
tableboxwidth <- 4.5
Regressands <- rep("TotalImputedValue", 6)
Addseparatingcols <- NULL; Separatingcolwidth <- NULL
Separatingcoltitle <- NULL
<<livestock regression select covariates, echo = T>>=
source(paste0(pathprogram, "LivestockCovariateSelection.R"))
<<livestock regression estimation>>=
exclheader <- paste0("excl", Lvsuffixes)
source(paste0(pathprogram, "FDEstimationFile.R"))
@
<<Total number of cows by cow holding at rd 1, warning = F, message = F, fig.align='center', fig.height = 6, fig.width = 10, fig.cap = paste0("Number of cows owned", "\\\\ {\\footnotesize Cow ownership is defined at the baseline.\\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
lvo[, dummyHadCows := factor(dummyHadCows, labels = c("do not own a cow", "own a cow"))]
g <- ggplot(data = lvo[!is.na(Arm), ], 
    aes(x= factor(tee), y = NumCows, group = factor(tee), 
    colour = dummyHadCows, dodge = dummyHadCows)) + 
  geom_boxplot()+
  geom_point(size = .3, position = position_jitterdodge(dodge.width = .8, jitter.height = .4))+
  labs(shape="cow ownership at baseline", 
    caption = "(Cow ownership uses the self-reported baseline information.)") +
  scale_x_discrete(breaks = 1:4, limits = 1:4) +
  scale_y_continuous(breaks = seq(0, 10, 1), limits = c(0, 10)) +
  theme(
   axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1), 
   strip.text.y = element_text(colour = "blue"), 
   legend.position = "bottom", 
   ) +
  facet_grid(dummyHadCows ~ Arm)
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "NumberCowsOwnedByExperienceAndArm.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
<<Fig cows, warning = F, message = F, fig.align='center', fig.height = 6, fig.width = 10, fig.cap = paste0("Number of cows owned by loan receipt", "\\\\ {\\footnotesize Cow ownership is defined at the baseline.\\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
table(lvo[, .(tee, dummyHadCows, Arm)])
lvo[, creditstatus := factor(creditstatus, levels = c("Yes", "No"))]
lvo[, creditstatus := factor(creditstatus, labels = c("received a loan", "not received a loan"))]
cowstat <- lvo[, .(MeanNumCows = mean(NumCows, na.rm = T), N = .N), 
  by = .(Arm, tee, creditstatus, dummyHadCows)]
setkey(cowstat, Arm, creditstatus, dummyHadCows, tee)
g <- ggplot(lvo[, .(Arm, creditstatus, hhid, tee, NumCows, dummyHadCows)], 
  aes(x = tee, y = NumCows, colour = dummyHadCows, group = Arm)) +
  geom_point(aes(colour = dummyHadCows), 
    size = .1, position = position_jitter(width = .2)) +
  geom_smooth(span = .5, 
    aes(colour = dummyHadCows, group = dummyHadCows)) +
  labs(shape="cow ownership at baseline", 
    caption = "(Cow ownership uses the self-reported baseline information.)") +
  theme(legend.position="bottom", 
    legend.key = element_rect(fill = "white"),
    legend.title = element_text(size = 9)) + 
  scale_y_continuous(limits = c(0, 8)) +
  scale_x_continuous() +
  xlab("Survey round") + ylab("Number of cows") +
  facet_grid(creditstatus ~ Arm)
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "NumberCowsOwnedByCreditstatusAndArm.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
@
\clearpage
\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of livestock holding values\label{tab FD livestock}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "LivestockFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Regressand is \textsf{TotalImputedValue}, a sum of all livestock holding values evaluated at respective median market prices in the same year. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of livestock holding values, with vs. without a grace period\label{tab FD livestock2}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "LivestockGraceFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Regressand is \textsf{TotalImputedValue}, a sum of all livestock holding values evaluated at respective median market prices in the same year. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of livestock holding values, rd 1 vs. rd 4 comparison\label{tab FD livestock3}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "LivestockRd14DiffFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Regressand is \textsf{TotalImputedValue}, a sum of all livestock holding values evaluated at respective median market prices in the same year. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

Check quickly if the estimated results make sense. \textsf{xid} is from the file I received as updated id file (Oct 18, 2017).
<<Check quickly if the estimated results make sense, warning = F>>=
lvo <-  readRDS(paste0(pathsaveHere, "LivestockAdminDataUsedForEstimation.rds"))
#lvo[tee == 3 & grepl("e$", Arm) & TotalImputedValue > 1000000, ]
# define attrition status
lvo[, AttritLV := 1L]
lvo[hhid %in% hhid[tee == 4], AttritLV := 0L]
xid <- readRDS(paste0(path1234, "ID.rds"))
xidlv <- xid[,.(groupid, hhid, survey, year, creditstatus)]
setkey(lvo, groupid, hhid, survey)
setkey(xidlv, groupid, hhid, survey)
lvo <- xidlv[lvo]
setkey(lvo, Arm, tee)
destat(lvo[, .(hhid, TotalImputedValue)])
#lvo[tee == 3 & grepl("e$", Arm) & TotalImputedValue > 1000000, ]
lvostat <- lvo[grepl("es", creditstatus),.(MeanIV = mean(TotalImputedValue, na.rm = T), 
  StdIV = var(TotalImputedValue, na.rm = T)^(.5), 
  N = sum(!is.na(TotalImputedValue))), by = .(Arm, tee)]
lvostat[, c("ciLB", "ciUB") := list(MeanIV - StdIV * qt(.975, N- 1), MeanIV + StdIV * qt(.975, N- 1))]
setkey(lvo, hhid, survey)
# lvo[hhid %in% hhid[TotalImputedValue > 100000],
#   .(hhid, Arm, Year, LivestockCode, number_owned, 
#   mrkt_value, TotalImputedValue)]
lvo[, HoldingClass := "below 1000"]
lvo[TotalImputedValue >= 1000 & TotalImputedValue < 30000, 
  HoldingClass := "1000-29999"]
lvo[TotalImputedValue >= 30000 & TotalImputedValue < 50000, 
  HoldingClass := "30000-49999"]
lvo[TotalImputedValue >= 50000, 
  HoldingClass := "above 50000"]
lvo[, HoldingClass := factor(HoldingClass, 
  levels = c("below 1000", "1000-29999", "30000-49999", "above 50000"))]
setkey(lvo, Arm, HoldingClass, tee)
lvostat2 <- lvo[grepl("es", creditstatus),.(MeanIV = mean(TotalImputedValue, na.rm = T), 
  StdIV = var(TotalImputedValue, na.rm = T)^(.5), 
  N = sum(!is.na(TotalImputedValue))), by = .(Arm, HoldingClass, tee)]
lvostat2[, c("ciLB", "ciUB") := list(MeanIV - StdIV * qt(.975, N- 1), MeanIV + StdIV * qt(.975, N- 1))]
lvostat3 <- lvo[grepl("es", creditstatus),.(MeanIV = mean(TotalImputedValue, na.rm = T), 
  StdIV = var(TotalImputedValue, na.rm = T)^(.5), 
  N = sum(!is.na(TotalImputedValue))), by = .(Arm, HoldingClass, Year)]
lvostat3[, c("ciLB", "ciUB") := list(MeanIV - StdIV * qt(.975, N- 1), MeanIV + StdIV * qt(.975, N- 1))]
lvostat4 <- lvo[grepl("es", creditstatus),.(MeanIV = mean(TotalImputedValue, na.rm = T), 
  StdIV = var(TotalImputedValue, na.rm = T)^(.5), 
  N = sum(!is.na(TotalImputedValue))), by = .(Arm, HoldingClass, AttritLV, tee)]
lvostat4[, c("ciLB", "ciUB") := list(MeanIV - StdIV * qt(.975, N- 1), MeanIV + StdIV * qt(.975, N- 1))]
lvostat5 <- lvo[grepl("es", creditstatus),.(MeanIV = mean(TotalImputedValue, na.rm = T), 
  StdIV = var(TotalImputedValue, na.rm = T)^(.5), 
  N = sum(!is.na(TotalImputedValue))), by = .(Arm, HoldingClass, AttritLV, Year)]
lvostat5[, c("ciLB", "ciUB") := list(MeanIV - StdIV * qt(.975, N- 1), MeanIV + StdIV * qt(.975, N- 1))]
<<Total imputed value histogram, warning = F, message = F, fig.align='center', fig.height = 3, fig.width = 10, fig.cap = paste0("Total imputed value of livestock holding", "\\\\ {\\footnotesize Livestock holding values are computed by using respective median prices of each year.\\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
g <- ggplot(data = lvo[TotalImputedValue > 0], aes(TotalImputedValue)) + 
  geom_histogram(breaks = c(0, seq(10000, 200000, 10000))) + 
  #scale_x_log10(breaks = c(1, 100, 1000, 10000, 20000, 30000, 50000)) +
  scale_x_continuous(breaks = seq(0, 200000, 20000)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1), 
   strip.text.y = element_text(colour = "blue"))+
  facet_grid(tee ~ Arm)
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "TotalImputedValueByArm.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
<<Histogram of livestock holding classes, warning = F, message = F, fig.align='center', fig.height = 5, fig.width = 10, fig.cap = paste0("Histogram of livestock holding classes", "\\\\ {\\footnotesize Livestock holding values are computed by using respective median prices of each year.\\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
g <- ggplot(data = lvostat2, aes(HoldingClass, N)) + 
  geom_col() +
  xlab("Livestock holding classes") +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1), 
    strip.text.y = element_text(colour = "blue"))+
  facet_grid(tee ~ Arm)
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "LivestockHoldingClasses.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
<<Histogram of livestock holding classes with attrition, warning = F, message = F, fig.align='center', fig.height = 5, fig.width = 10, fig.cap = paste0("Histogram of livestock holding classes", "\\\\ {\\footnotesize Livestock holding values are computed by using respective median prices of each year. Boxes without a colour accounts for attrited households.\\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
lvostat4[, Attrition := "Attrited"]
lvostat4[AttritLV == 0, Attrition := "Remained"]
lvostat4[, Attrition := factor(Attrition)]
g <- ggplot(data = lvostat4, aes(HoldingClass, N, fill = Attrition, colour  = "blue")) + 
  geom_col(colour  = "blue") +
  xlab("Livestock holding classes") +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1), 
    strip.text.y = element_text(colour = "blue"),
    legend.position = "below") +
  scale_fill_manual("legend", values = c("Attried" = "#99CCFF", "Remained" = "#000099")) +
  facet_grid(tee ~ Arm)
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "LivestockHoldingClassesWithAttrition.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
<<Histogram of livestock holding classes by year, warning = F, message = F, fig.align='center', fig.height = 5, fig.width = 10, fig.cap = paste0("Histogram of livestock holding classes by year", "\\\\ {\\footnotesize Livestock holding values are computed by using respective median prices of each year.\\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
g <- ggplot(data = lvostat3[Year != 2011 & Year != 2013, ], aes(HoldingClass, N)) + 
  geom_col() +
  xlab("Livestock holding classes") +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1), 
    strip.text.y = element_text(colour = "blue"))+
  facet_grid(Year ~ Arm)
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "LivestockHoldingClassesByYear.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
<<Histogram of livestock holding classes with attrition by year, warning = F, message = F, fig.align='center', fig.height = 5, fig.width = 10, fig.cap = paste0("Histogram of livestock holding classes by year", "\\\\ {\\footnotesize Livestock holding values are computed by using respective median prices of each year. Boxes without a colour accounts for attrited households.\\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
lvostat5[, Attrition := "Attrited"]
lvostat5[AttritLV == 0, Attrition := "Remained"]
lvostat5[, Attrition := factor(Attrition)]
g <- ggplot(data = lvostat5[Year != 2011 & Year != 2013, ], 
    aes(HoldingClass, N, fill = Attrition, colour  = "blue")) + 
  geom_col(colour  = "blue") +
  xlab("Livestock holding classes") +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1), 
    strip.text.y = element_text(colour = "blue"),
    legend.position = "below") +
  scale_fill_manual("legend", values = c("Attried" = "#99CCFF", "Remained" = "#000099")) +
  facet_grid(Year ~ Arm)
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "LivestockHoldingClassesWithAttritionByYear.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
@
\begin{itemize}
\vspace{1.0ex}\setlength{\itemsep}{1.0ex}\setlength{\baselineskip}{12pt}
\item	Why does \textsf{cow} report below 1000 holding in rds 2-4?
\end{itemize}
<<MeanImputedVal MeanNumCows N by Arm survey>>=
lvo[, NumberOfCows := 0L]
lvo[grepl("ow", LivestockCode), NumberOfCows := as.integer(number_owned)]
lvo[,
  .(MeanImputedVal = mean(TotalImputedValue, na.rm = T), 
  MeanNumCows = mean(NumberOfCows, na.rm = T), 
  N = sum(!is.na(TotalImputedValue))), by = .(Arm, survey)]
#lvo[,.(N = sum(!is.na(TotalImputedValue))), by = .(Arm, survey)]
<<Number of cows by year, warning = F, message = F, fig.align='center', fig.height = 5, fig.width = 10, fig.cap = paste0("Number of cows/oxen by year", "\\\\ {\\footnotesize Means are mean holding among the owners. Totals are total number of cows/oxen owned. Mean and total number of cows/oxen may diverge because the number of owners differ across round.\\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
lvo[, LivestockType := LivestockCode]
lvo[grepl("Ox|Cow", LivestockCode), LivestockType := "Cow/Ox"]
lvo[grepl("Goat|She", LivestockCode), LivestockType := "Goat/Sheep"]
lvo[grepl("Duc|Hen", LivestockCode), LivestockType := "Poultry"]
lvo[, LivestockType := factor(LivestockType)]
lvotype <- lvo[grepl("es", creditstatus), 
  .(Std = var(number_owned, na.rm = T)^(.5), 
    Total = sum(number_owned, na.rm = T), 
    N = sum(!is.na(number_owned))), 
    by = .(Arm,  LivestockType, Year)]
#lvotype <- lvotype[LivestockType != "", ]
lvotype[, Mean := round(Total/N, 1)]
setnames(lvotype, grepout("^T|N|^S|^M", colnames(lvotype)), 
  paste0("value.", grepout("^T|N|^S|^M", colnames(lvotype))))
lvotype[is.na(LivestockType), LivestockType := "Other"]
lvotypel <- reshape(lvotype, direction = "long", 
  idvar = c("Arm", "LivestockType", "Year"),
  varying = grepout("val", colnames(lvotype)))
lvotypel <- lvotypel[LivestockType != "", ]
lvotypel <- lvotypel[grepl("ow", LivestockType) & grepl("Mean|Tot|^N", time), ]
setkey(lvotypel, Arm, Year, LivestockType)
lvotypel[, Variable := time]
lvotypel[grepl("N", time), Variable := "Number of owners"]
lvotypel[, Variable := factor(Variable, levels = c("Mean", "Total", "Number of owners"))]
g <- ggplot(data = lvotypel, aes(Year, value)) + 
  geom_col(data = lvotypel[grepl("Total", Variable), ]) +
  geom_col(data = lvotypel[grepl("Mean", Variable), ]) +
  geom_col(data = lvotypel[grepl("N", Variable), ]) +
  xlab("Year") +
	  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1), 
    strip.text.y = element_text(colour = "blue"))+
  facet_grid(Variable ~ Arm, scale = "free_y")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "NumberCowsByStats.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
<<Number of cows by rd, warning = F, message = F, fig.align='center', fig.height = 5, fig.width = 10, fig.cap = paste0("Number of cows/oxen by survey round", "\\\\ {\\footnotesize Means are mean holding among the owners. Totals are total number of cows/oxen owned. Mean and total number of cows/oxen may diverge because the number of owners differ across round.\\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
lvo[, LivestockType := LivestockCode]
lvo[grepl("Ox|Cow", LivestockCode), LivestockType := "Cow/Ox"]
lvo[grepl("Goat|She", LivestockCode), LivestockType := "Goat/Sheep"]
lvo[grepl("Duc|Hen", LivestockCode), LivestockType := "Poultry"]
lvo[, LivestockType := factor(LivestockType)]
lvotype <- lvo[grepl("es", creditstatus), 
  .(Std = var(number_owned, na.rm = T)^(.5), 
    Total = sum(number_owned, na.rm = T), 
    N = sum(!is.na(number_owned))), 
    by = .(Arm,  LivestockType, tee)]
#lvotype <- lvotype[LivestockType != "", ]
lvotype[, Mean := round(Total/N, 1)]
setnames(lvotype, grepout("^T|N|^S|^M", colnames(lvotype)), 
  paste0("value.", grepout("^T|N|^S|^M", colnames(lvotype))))
lvotype[is.na(LivestockType), LivestockType := "Other"]
lvotypel <- reshape(lvotype, direction = "long", 
  idvar = c("Arm", "LivestockType", "tee"),
  varying = grepout("val", colnames(lvotype)))
lvotypel <- lvotypel[LivestockType != "", ]
lvotypel <- lvotypel[grepl("ow", LivestockType) & grepl("Mean|Tot|^N", time), ]
setkey(lvotypel, Arm, tee, LivestockType)
lvotypel[, Variable := time]
lvotypel[grepl("N", time), Variable := "Number of owners"]
lvotypel[, Variable := factor(Variable, levels = c("Mean", "Total", "Number of owners"))]
g <- ggplot(data = lvotypel, aes(tee, value)) + 
  geom_col(data = lvotypel[grepl("Total", Variable), ], colour  = "blue") +
  geom_col(data = lvotypel[grepl("Mean", Variable), ], colour  = "blue") +
  geom_col(data = lvotypel[grepl("N", Variable), ], colour  = "blue") +
  xlab("Round") +
	  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1), 
    strip.text.y = element_text(colour = "blue"))+
  facet_grid(Variable ~ Arm, scale = "free_y")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "NumberCowsByStatsByRd.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
@
\begin{palepinkleftbar}
\begin{finding}
\textsc{\small Figure \ref{Figure Total imputed value histogram}} shows a general increase in upper holding classes round 3 and further upper holding classes in round 4. \textsc{\small Figure \ref{Figure Number of cows by year}} shows livestock type is not entered (yet collected) in rd3. At this moment, one needs to omit rd 3. All estimation results by far are subject to this omission.
\end{finding}
\end{palepinkleftbar}

\subsubsection{Traditional arm households who buy cows}

Some traditional arm households buy cows. Characteristics of these households.

<<read livestock data to get HH characteristics, warning = F>>=
lvo <-  readRDS(paste0(pathsaveHere, "LivestockAdminDataUsedForEstimation.rds"))
lvo[, LivestockType := LivestockCode]
lvo[grepl("Ox|Cow", LivestockCode), LivestockType := "Cow/Ox"]
lvo[grepl("Goat|She", LivestockCode), LivestockType := "Goat/Sheep"]
lvo[grepl("Duc|Hen", LivestockCode), LivestockType := "Poultry"]
lvo[, LivestockType := factor(LivestockType)]
lvohold <- lvo[grepl("es", creditstatus), .(
    Total = sum(number_owned, na.rm = T),
    SoldOrDied = sum(sales_cow, na.rm = T) + sum(sales_ox, na.rm = T) + sum(dead, na.rm = T),
    born = born
    ), 
    by = .(Arm, hhid, LivestockType, survey)]
lvohold <- a2b.data.table(lvohold, NA, 0)
lvh <- reshape(lvohold, direction = "wide", idvar = c("Arm", "hhid", "LivestockType"),
  timevar = "survey", v.names = grepout("Total|Sol|bo", colnames(lvohold)))
setnames(lvh, grepout("Total|Sol|bo", colnames(lvh)), 
  gsub("\\.", "", grepout("Total|Sol|bo", colnames(lvh))))
lvh[LivestockType == "", LivestockType := "unknown"]
lvh[, LivestockType := gsub("\\/", "", LivestockType)]
lvhw <- reshape(lvh, direction = "wide", idvar = c("Arm", "hhid"),
  timevar = "LivestockType", v.names = grepout("Total|Sol|bo", colnames(lvh)))
setnames(lvhw, grepout("Total", colnames(lvhw)),
  gsub("^Total(.*?)\\.(.*)$", "\\2.\\1", grepout("Total", colnames(lvhw))))
setnames(lvhw, grepout("cow", colnames(lvhw)),
  gsub("cowox", "CowOx", grepout("cow", colnames(lvhw))))
setnames(lvhw, grepout("Chi", colnames(lvhw)),
  gsub("du", "Du", grepout("Chi", colnames(lvhw))))
lvhw1 <- lvhw[, c("Arm", "hhid", grepout("^C|^Go", colnames(lvhw))), with = F]
lvhwS <- lvhw[, c("Arm", "hhid", grepout("So", colnames(lvhw))), with = F]
lvhwB <- lvhw[, c("Arm", "hhid", grepout("bo", colnames(lvhw))), with = F]
setnames(lvhwS, grepout("So", colnames(lvhwS)),
  gsub("^SoldOrDied(.*?)\\.(.*)$", "\\2.\\1", grepout("Sol", colnames(lvhwS))))
setnames(lvhwB, grepout("bo", colnames(lvhwB)),
  gsub("^born(.*?)\\.(.*)$", "\\2.\\1", grepout("bo", colnames(lvhwB))))
lvl1 <- reshape(lvhw1, direction = "long", idvar = c("Arm", "hhid"),
  varying = grepout("[1-4]", colnames(lvhw1)))
lvlS <- reshape(lvhwS, direction = "long", idvar = c("Arm", "hhid"),
  varying = grepout("[1-4]", colnames(lvhwS)))
lvlB <- reshape(lvhwB, direction = "long", idvar = c("Arm", "hhid"),
  varying = grepout("[1-4]", colnames(lvhwB)))
setnames(lvl1, "time", "survey"); setnames(lvlS, "time", "survey"); setnames(lvlB, "time", "survey")
lvl1[, Variable := "total"]; lvlS[, Variable := "solddied"]; lvlB[, Variable := "born"]
lvl <- rbindlist(list(lvl1, lvlS, lvlB), use.names = T, fill = T)
lvl <- a2b.data.table(lvl, NA, 0)
setkey(lvl, Arm, hhid, Variable, survey)
lvW <- reshape(lvl, direction = "wide", idvar = c("Arm", "hhid", "survey"),
  timevar = "Variable", v.names = grepout("C|G|^u", colnames(lvl)))
setkey(lvW, Arm, hhid, survey)
for (l in c("CowOx", "GoatSheep", "ChickenDuck", "unknown")) {
  lvW[, paste0(l, ".diff") := 
    eval(parse(text = paste0(l, ".born"))) - eval(parse(text = paste0(l, ".solddied")))]
  lvW[, paste0(l, ".totdiff") := c(0, diff(eval(parse(text = paste0(l, ".total"))))), by = hhid]
  lvW[, paste0(l, ".inconsistent") := 
    eval(parse(text = paste0(l, ".totdiff"))) - eval(parse(text = paste0(l, ".diff")))]
}
# Below shows inconsistency across rounds in reported cows within same households
#lvW[hhid == 7020802 | hhid == 7020803, grepout("hh|sur|Co|Ar", colnames(lvW)), with = F]
setkey(lvW, Arm, hhid, survey)
<<livestock holdinng of non creditreceivers>>=
lvo <-  readRDS(paste0(pathsaveHere, "LivestockAdminDataUsedForEstimation.rds"))
lvo[, LivestockType := LivestockCode]
lvo[grepl("Ox|Cow", LivestockCode), LivestockType := "Cow/Ox"]
lvo[grepl("Goat|She", LivestockCode), LivestockType := "Goat/Sheep"]
lvo[grepl("Duc|Hen", LivestockCode), LivestockType := "Poultry"]
lvo[, LivestockType := factor(LivestockType)]
lvNLohold <- lvo[grepl("No", creditstatus), .(
    Total = sum(number_owned, na.rm = T),
    SoldOrDied = sum(sales_cow, na.rm = T) + sum(sales_ox, na.rm = T) + sum(dead, na.rm = T),
    born = born
    ), 
    by = .(Arm, hhid, LivestockType, survey)]
lvNLohold <- a2b.data.table(lvNLohold, NA, 0)
lvNLh <- reshape(lvNLohold, direction = "wide", idvar = c("Arm", "hhid", "LivestockType"),
  timevar = "survey", v.names = grepout("Total|Sol|bo", colnames(lvNLohold)))
setnames(lvNLh, grepout("Total|Sol|bo", colnames(lvNLh)), 
  gsub("\\.", "", grepout("Total|Sol|bo", colnames(lvNLh))))
lvNLh[LivestockType == "", LivestockType := "unknown"]
lvNLh[, LivestockType := gsub("\\/", "", LivestockType)]
lvNLhw <- reshape(lvNLh, direction = "wide", idvar = c("Arm", "hhid"),
  timevar = "LivestockType", v.names = grepout("Total|Sol|bo", colnames(lvNLh)))
setnames(lvNLhw, grepout("Total", colnames(lvNLhw)),
  gsub("^Total(.*?)\\.(.*)$", "\\2.\\1", grepout("Total", colnames(lvNLhw))))
setnames(lvNLhw, grepout("cow", colnames(lvNLhw)),
  gsub("cowox", "CowOx", grepout("cow", colnames(lvNLhw))))
setnames(lvNLhw, grepout("Chi", colnames(lvNLhw)),
  gsub("du", "Du", grepout("Chi", colnames(lvNLhw))))
lvNLhw1 <- lvNLhw[, c("Arm", "hhid", grepout("^C|^Go", colnames(lvNLhw))), with = F]
lvNLhwS <- lvNLhw[, c("Arm", "hhid", grepout("So", colnames(lvNLhw))), with = F]
lvNLhwB <- lvNLhw[, c("Arm", "hhid", grepout("bo", colnames(lvNLhw))), with = F]
setnames(lvNLhwS, grepout("So", colnames(lvNLhwS)),
  gsub("^SoldOrDied(.*?)\\.(.*)$", "\\2.\\1", grepout("Sol", colnames(lvNLhwS))))
setnames(lvNLhwB, grepout("bo", colnames(lvNLhwB)),
  gsub("^born(.*?)\\.(.*)$", "\\2.\\1", grepout("bo", colnames(lvNLhwB))))
lvNLl1 <- reshape(lvNLhw1, direction = "long", idvar = c("Arm", "hhid"),
  varying = grepout("[1-4]", colnames(lvNLhw1)))
lvNLlS <- reshape(lvNLhwS, direction = "long", idvar = c("Arm", "hhid"),
  varying = grepout("[1-4]", colnames(lvNLhwS)))
lvNLlB <- reshape(lvNLhwB, direction = "long", idvar = c("Arm", "hhid"),
  varying = grepout("[1-4]", colnames(lvNLhwB)))
setnames(lvNLl1, "time", "survey"); setnames(lvNLlS, "time", "survey"); setnames(lvNLlB, "time", "survey")
lvNLl1[, Variable := "total"]; lvNLlS[, Variable := "solddied"]; lvNLlB[, Variable := "born"]
lvNLl <- rbindlist(list(lvNLl1, lvNLlS, lvNLlB), use.names = T, fill = T)
lvNLl <- a2b.data.table(lvNLl, NA, 0)
setkey(lvNLl, Arm, hhid, Variable, survey)
lvNLw <- reshape(lvNLl, direction = "wide", idvar = c("Arm", "hhid", "survey"),
  timevar = "Variable", v.names = grepout("C|G|^u", colnames(lvNLl)))
setkey(lvNLw, Arm, hhid, survey)
for (l in c("CowOx", "GoatSheep", "ChickenDuck", "unknown")) {
  lvNLw[, paste0(l, ".diff") := 
    eval(parse(text = paste0(l, ".born"))) - eval(parse(text = paste0(l, ".solddied")))]
  lvNLw[, paste0(l, ".totdiff") := c(0, diff(eval(parse(text = paste0(l, ".total"))))), by = hhid]
  lvNLw[, paste0(l, ".inconsistent") := 
    eval(parse(text = paste0(l, ".totdiff"))) - eval(parse(text = paste0(l, ".diff")))]
}
setkey(lvNLw, Arm, hhid, survey)
@
Merge non receivers and receivers of loans.
<<Merge non receivers and receivers of loans>>=
lvW[, ReceivedCredit := 1L]
lvNLw[, ReceivedCredit := 0L]
lvw <- rbindlist(list(lvW, lvNLw))
@
Number of HHs in \textsf{traditional} arm with inconsistent (e.g., rd1 2 cows, rd2 0 cow, rd3 2 cows, etc.) reporting of cow ownership across rounds:
<<Number of HHs in traditional arm with inconsistent reporting of cow ownership across rounds>>=
length(unique(lvw[CowOx.inconsistent != 0 & grepl("tr", Arm), hhid]))
@
<<>>=
lvw[, NoCow := all(CowOx.total == 0), by = hhid]
AllHHs <- unique(lvw[, hhid])
HHsTrad <- AllHHs[
  AllHHs %in% ar[grepl("tra", Arm), hhid]]
HHsWithNoCow <- AllHHs[
  AllHHs %in% lvw[(NoCow), hhid]]
HHsWithoutACow <- AllHHs[
  AllHHs %in% HHsTrad & AllHHs %in% HHsWithNoCow]
HHsWithACowOnce <- AllHHs[
  AllHHs %in% HHsTrad & !(AllHHs %in% HHsWithNoCow)]
HHsWhoReceivedLoan <- AllHHs[
  AllHHs %in% ar[grepl("es", creditstatus), hhid]]
HHsWhoDidNotReceiveLoan <- AllHHs[
  AllHHs %in% ar[!grepl("es", creditstatus), hhid]]

HHsWhoIncreased <- AllHHs[
  AllHHs %in% unique(lvw[CowOx.totdiff > 0, hhid])]
  HHsWhoIncreasedTrad <- HHsWhoIncreased[
      HHsWhoIncreased %in% HHsTrad]
    HHsWhoIncreasedTradWithCow <- HHsWhoIncreasedTrad[
        HHsWhoIncreasedTrad %in% HHsWithACowOnce]
HHsWhoDidNotIncrease <- AllHHs[
  !(AllHHs %in% HHsWhoIncreased)]
  HHsWhoDidNotIncreaseTrad <- HHsWhoDidNotIncrease[
      HHsWhoDidNotIncrease %in% HHsTrad]
    HHsWhoDidNotIncreaseTradWithCow <- HHsWhoDidNotIncreaseTrad[
        HHsWhoDidNotIncreaseTrad %in% HHsWithACowOnce]
HHsWhoDecreased <- AllHHs[
  AllHHs %in% unique(lvw[CowOx.totdiff < 0, hhid])]
HHsWhoIncreasedAndDecreased <- intersect(
  HHsWhoIncreased, HHsWhoDecreased)
  HHsWhoIncreasedAndDecreasedWithCow <- 
      HHsWhoIncreasedAndDecreased[
      HHsWhoIncreasedAndDecreased %in% HHsWithACowOnce]
  HHsWhoIncreasedAndDecreasedTrad <- HHsWhoIncreasedAndDecreased[
      HHsWhoIncreasedAndDecreased %in% HHsTrad]
    HHsWhoIncreasedAndDecreasedTradWithCow <- 
        HHsWhoIncreasedAndDecreasedTrad[
        HHsWhoIncreasedAndDecreasedTrad %in% HHsWithACowOnce]
HHsWhoOnlyIncreased <- HHsWhoIncreased[
  !(HHsWhoIncreased %in% HHsWhoDecreased)]
  HHsWhoOnlyIncreasedWithCow <- HHsWhoOnlyIncreased[
      HHsWhoOnlyIncreased %in% HHsWithACowOnce]
  HHsWhoOnlyIncreasedTrad <- HHsWhoOnlyIncreased[
      HHsWhoOnlyIncreased %in% HHsTrad]
    HHsWhoOnlyIncreasedTradWithCow <- HHsWhoOnlyIncreasedTrad[
        HHsWhoOnlyIncreasedTrad %in% HHsWithACowOnce]

  HHsWhoReceivedLoanTrad <- HHsWhoReceivedLoan[
      HHsWhoReceivedLoan %in% HHsTrad]
  HHsWhoDidNotReceiveLoanTrad <- HHsWhoDidNotReceiveLoan[
      HHsWhoReceivedLoanTrad %in% HHsTrad]
  HHsWhoOnlyIncreasedTradLoan <- HHsWhoOnlyIncreasedTradWithCow[
      HHsWhoOnlyIncreasedTradWithCow %in% HHsWhoReceivedLoan]
  HHsWhoOnlyIncreasedTradNoLoan <- HHsWhoOnlyIncreasedTradWithCow[
      !(HHsWhoOnlyIncreasedTradWithCow %in% HHsWhoReceivedLoan)]
  HHsWhoIncreasedAndDecreasedTradLoan <-  
      HHsWhoIncreasedAndDecreasedTradWithCow[
      HHsWhoIncreasedAndDecreasedTradWithCow %in% HHsWhoReceivedLoan]
  HHsWhoIncreasedAndDecreasedTradNoLoan <-
      HHsWhoIncreasedAndDecreasedTradWithCow[
      !(HHsWhoIncreasedAndDecreasedTradWithCow %in% HHsWhoReceivedLoan)]
  HHsWhoDidNotIncreaseTradLoan <- HHsWhoDidNotIncreaseTradWithCow[
      HHsWhoDidNotIncreaseTradWithCow %in% HHsWhoReceivedLoan]
  HHsWhoDidNotIncreaseTradNoLoan <- HHsWhoDidNotIncreaseTradWithCow[
      !(HHsWhoDidNotIncreaseTradWithCow %in% HHsWhoReceivedLoan)]
@
There are \Sexpr{length(AllHHs)} HHs in the livestock data, of which: \Sexpr{length(HHsWhoOnlyIncreased)} increased and did not decrease cow ownership (strictly increasing), \Sexpr{length(HHsWhoIncreasedAndDecreased)} increased and also decreased cow ownership, and \Sexpr{length(HHsWhoDidNotIncrease)} did not increase (decreased or no change), totaling to \Sexpr{length(HHsWhoOnlyIncreased)+length(HHsWhoIncreasedAndDecreased)+length(HHsWhoDidNotIncrease)}. Within \textsf{traditional} arm, there are \Sexpr{length(HHsWithoutACow)} HHs without a cow throughout the survey periods, and \Sexpr{length(HHsWithACowOnce)} HHs with a cow at least once. Among the HHs with a cow at least once, 
\Sexpr{length(HHsWhoOnlyIncreasedTradWithCow)} 
[\Sexpr{length(HHsWhoOnlyIncreasedTradLoan)} with a loan, 
\Sexpr{length(HHsWhoOnlyIncreasedTradNoLoan)} without a loan] 
increased and did not decrease cow ownership (strictly increasing), 
\Sexpr{length(HHsWhoIncreasedAndDecreasedTradWithCow)} increased and also decreased cow ownership [
\Sexpr{length(HHsWhoIncreasedAndDecreasedTradLoan)} with a loan, 
\Sexpr{length(HHsWhoIncreasedAndDecreasedTradNoLoan)} without a loan], and 
\Sexpr{length(HHsWhoDidNotIncreaseTradWithCow)} did not increase (decreased or no change) [
\Sexpr{length(HHsWhoDidNotIncreaseTradLoan)} with a loan, 
\Sexpr{length(HHsWhoDidNotIncreaseTradNoLoan)} without a loan], 
totaling to 
\Sexpr{length(HHsWhoOnlyIncreasedTradWithCow)+length(HHsWhoIncreasedAndDecreasedTradWithCow)+length(HHsWhoDidNotIncreaseTradWithCow)}.

\Sexpr{length(HHsWhoReceivedLoan)} and \Sexpr{length(HHsWhoDidNotReceiveLoan)} HHs received and did not receive a loan, respectively.


Number of HHs in \textsf{traditional} arm with an increase in cows at least once among nonzero cow ownership:
<<>>=
#length(unique(lvw[hhid %in% HHsWhoIncreased & grepl("tr", Arm), hhid]))
length(HHsWhoIncreasedTradWithCow)
@
Number of HHs in \textsf{traditional} arm with an increase in cows at least once and with a decrease in in cows at least once:
<<>>=
#length(unique(lvw[hhid %in% HHsWhoIncreasedAndDecreased & grepl("tr", Arm), hhid]))
length(HHsWhoIncreasedAndDecreasedTradWithCow)
@
There are many increase-decrease-increase patterns in cow ownership, which implies puchase-sales-puchase... which is implausible. Checking against livestock sales data. \textsf{CowOx.diff} is contemporaneous difference between births and sales/deaths, \textsf{CowOx.totdiff} is a first-difference of \textsf{CowOx.total} which is a sum of livestock holding by cow/ox, goat/sheep, chicken/duck. %\textsf{DCow} = \textsf{CowOx.totdiff}.
<<>>=
#lvw[CowOx.totdiff > 0 & grepl("tr", Arm), .(hhid, survey, CowOx.total, CowOx.totdiff)]
lvl2 <- reshape(lvw, direction = "long", idvar = c("Arm", "hhid", "survey", "ReceivedCredit"),
  varying = grepout("^C|G|^u", colnames(lvw)))
setnames(lvl2, "time", "Variable")
#dcow <- lvl2[grepl("tr", Arm) & grepl("totdiff", Variable), 
#  .(survey = survey, DCow = CowOx), by = hhid]
#dcow[DCow != 0, ]
lvw[grepl("tr", Arm) & CowOx.totdiff != 0, grepout("hh|sur|Co|Ar", colnames(lvw)), with = F]
#lvw[hhid == 7020802 | hhid == 7020803, grepout("hh|sur|Co|Ar", colnames(lvw)), with = F]
@
There are \Sexpr{length(unique(lvw[hhid %in% HHsWhoIncreased & grepl("tr", Arm), hhid]))} out of \Sexpr{length(unique(lvw[grepl("tr", Arm), hhid]))} members in \textsf{traditional} arm who increased the cow ownership at least once (of which \Sexpr{length(unique(lvw[hhid %in% HHsWhoIncreasedAndDecreased & grepl("tr", Arm), hhid]))} have decreased at least once). Examining HH characteristics shows that all who increased the ownership received a loan while among who did not increase the cow ownership, \Sexpr{round((1-mean(unlist(lvo[survey == 1 & hhid %in% HHsWhoDidNotIncrease & grepl("tr", Arm), .(ReceivedCredit = as.numeric(grepl("Yes", creditstatus)))])))*100, 2)}\% did not receive a loan. \textsc{\normalsize Table \ref{tab permutation trad cow}} shows that it is one of the largest contrasting difference of \textsf{traditional} arm members in baseline asset holding, poverty grades, and household structure. While receiving a loan is a choice variable hence is endogenous to the outcomes, it implies that, even when the loan amount is small, members who are willing to take a loan is more likely to increase cow ownership than who are not. So the small amount lending may still have a role in poverty reduction through livestock accumulation.

<<>>=
lvo <-  readRDS(paste0(pathsaveHere, "LivestockAdminDataUsedForEstimation.rds"))
ass <-  readRDS(paste0(pathsaveHere, "AssetAdminDataUsedForEstimation.rds"))
@
Members who received a loan in \textsf{traditional}:
<<tabulate Members who received a loan in traditional>>=
table0(lvo[grepl("tr", Arm) & survey == 1 & grepl("Ye", creditstatus), 
  .(increasedCow = hhid %in% HHsWhoIncreasedTradWithCow, 
    notincreasedCow = hhid %in% HHsWhoDidNotIncreaseTradWithCow)])
table0(lvo[survey == 1 & hhid %in% HHsWhoIncreasedTradWithCow,
  creditstatus])
table0(lvo[survey == 1 & hhid %in% HHsWhoDidNotIncreaseTradWithCow,
  creditstatus])
@
Members who did not receive a loan in \textsf{traditional}:
<<tabulate Members who did not receive a loan in traditional>>=
table0(lvo[grepl("tr", Arm) & survey == 1 & grepl("No", creditstatus), 
  .(increasedCow = hhid %in% HHsWhoIncreasedTradWithCow, 
    notincreasedCow = hhid %in% HHsWhoDidNotIncreaseTradWithCow)])
summary(lvo[grepl("tr", Arm) & grepl("No", creditstatus) & survey == 1, 
  .(hhid, survey, creditstatus, Mstatus, NumCows)])
#lvw[hhid %in% lvo[grepl("tr", Arm) & grepl("No", creditstatus), hhid], 
#  .(CowOx.totdiff, CowOx.total)]
# ar sample (fixed characteristics): 
#  HeadLiteracy, HeadAge,  HHsize, povertystatus, FloodInRd1
# lv sample (livestock characteristics): 
#  dummyHadCows, NumCowsOwnedAtRd1, ReceivedCredit
# as sample (asset characteristics): 
#  HAssetAmount, PAssetAmount, AssetAmount
<<grouping of permutation tests>>=
GroupingCond <- list(c(
  "hhid %in% HHsWhoIncreasedTradWithCow", 
  "hhid %in% HHsWhoDidNotIncreaseTradWithCow"),
  c(
  "hhid %in% HHsWhoOnlyIncreasedTradWithCow & grepl(\"Yes\", creditstatus)",
  "hhid %in% HHsWhoIncreasedAndDecreasedTradWithCow & grepl(\"Yes\", creditstatus)"),
  c(
  "hhid %in% HHsWhoOnlyIncreasedWithCow & grepl(\"Yes\", creditstatus)", 
  "hhid %in% HHsWhoIncreasedAndDecreasedWithCow & grepl(\"Yes\", creditstatus)"),
  c(
  "hhid %in% HHsWhoReceivedLoan",
  "hhid %in% HHsWhoDidNotReceiveLoan"))
#ar[eval(parse(text=GroupingObj[[2]][1])), .(hhid, HeadLiteracy, HeadAge)]
GroupingStringList <- list(
  c("increased in Trad", "decreased in Trad"),
  c("only increased in Trad", "increased and decreased in Trad"),
  c("only increased in all arms", "increased and decreased in all arms"),
  c("loan received", "loan not received"))
names(GroupingCond) <- names(GroupingStringList) <- 
  c("IncNotIncTradCow", "OnlyIncIncDecTradCow", 
    "OnlyIcIncDecCow", "LoanNoLoan")
<<permutation tests between groups using a loop>>=
arp <- ar[, .(hhid, HeadLiteracy, HeadAge,  HHsize, povertystatus, FloodInRd1, 
  creditstatus)]
# use rd 1 info for lvo and ass
ass[, povertystatus := povertystatus[!is.na(povertystatus)][1], by = hhid]
asp <- ass[survey == 1, .(hhid, NLHAssetAmount, PAssetAmount, NLAssetAmount,
  povertystatus, creditstatus)]
lvp <- lvo[survey == 1, .(hhid, dummyHadCows, NumCowsOwnedAtRd1, 
  povertystatus, creditstatus, ReceivedCredit = grepl("Yes", creditstatus))]
PermSamples <- c("TradIncreased_vs_NotIncreased", 
  "TradIncreased_vs_IncreasedDecreased", 
  "Increased_vs_IncreasedDecreased",
  "Received_vs_NotReceived")
vartobetested <- c(
  "HeadLiteracy", "HeadAge", 
    "HHsize", "povertystatus", "FloodInRd1", 
  "NLHAssetAmount", "PAssetAmount", "NLAssetAmount",
  "dummyHadCows", "NumCowsOwnedAtRd1", "ReceivedCredit")
permsamples0 <- c("ar", "as", "lv")
permsamples <- paste0(permsamples0, "p")
for (k in 1:length(GroupingCond)) {
  for (m in 1:length(permsamples)) {
    prms <- get(permsamples[m])
    # group 1 and 2
    prInc <- prms[eval(parse(text=GroupingCond[[k]][1])), ]
    prDec <- prms[eval(parse(text=GroupingCond[[k]][2])), ]
    prInc[, Group := GroupingStringList[[k]][1]]
    prDec[, Group := GroupingStringList[[k]][2]]
    prIN <- rbindlist(list(prInc, prDec))
    prIN[, Group := factor(Group, levels = GroupingStringList[[k]])]
    prIN[, PovertyStatus := 1L]
    prIN[hhid %in% unique(prIN[grepl("Mode", povertystatus), hhid]), 
      PovertyStatus := 0L]
    prIN <- prIN[!is.na(povertystatus), ]
    # unique to get only 1 obs per HH
    prINx <- unique(prIN)
    # copy characteristics across rounds
    if (m == 1) for (i in 1:5)  # ar
      prINx[, vartobetested[i] := eval(parse(text=
        paste0(vartobetested[i], "[!is.na(", vartobetested[i], ")][1]")
        )), by = hhid] else
    if (m == 2) for (i in 6:8)  # as
      prINx[, vartobetested[i] := eval(parse(text=
        paste0(vartobetested[i], "[!is.na(", vartobetested[i], ")][1]")
        )), by = hhid] else
    if (m == 3) for (i in 9:11) # lv
      prINx[, vartobetested[i] := eval(parse(text=
        paste0(vartobetested[i], "[!is.na(", vartobetested[i], ")][1]")
        )), by = hhid]
    assign(paste0(permsamples0[m], "IN", k), prINx)
  }
}
<<4 sample comparisons>>=
pmresults <- vector(mode = "list", length(vartobetested))
MeansAndN <- NULL
library(coin)
set.seed(20180923)
# 4 sample comparisons
PermSamples <- c("TradIncreased_vs_NotIncreased", 
  "TradIncreased_vs_IncreasedDecreased", 
  "Increased_vs_IncreasedDecreased",
  "Received_vs_NotReceived")
for (s in 1:length(PermSamples)) {
  arSample <- get(paste0("arIN", s))
  asSample <- get(paste0("asIN", s))
  lvSample <- get(paste0("lvIN", s))
  for (i in 1:grep("Flood", vartobetested)) {
    pmresults[[i]] <- independence_test(eval(parse(text=
      paste(vartobetested[i], "~ Group"))), data = arSample,
      distribution = approximate(B=10000))
    MeansAndN <- rbind(MeansAndN, 
      c(as.numeric(by(
        arSample[, eval(parse(text=paste(vartobetested[i])))], 
        arSample[, Group]
      , mean, na.rm = T)),
        as.numeric(by(
        arSample[, eval(parse(text=paste(vartobetested[i])))], 
        arSample[, Group]
      , length))))
  }
  for (i in grep("^HA", vartobetested):grep("^Asse", vartobetested)) {
    pmresults[[i]] <- independence_test(eval(parse(text=
      paste(vartobetested[i], "~ Group"))), data = asSample,
      distribution = approximate(B=10000))
    MeansAndN <- rbind(MeansAndN, 
      c(as.numeric(by(
        asSample[, eval(parse(text=paste(vartobetested[i])))], 
        asSample[, Group]
      , mean, na.rm = T)),
      as.numeric(by(
        asSample[, eval(parse(text=paste(vartobetested[i])))], 
        asSample[, Group]
      , length))))
  }
  if (length(unique(lvSample[, ReceivedCredit])) == 1) 
    endofvars <- length(vartobetested)-1 else endofvars <- length(vartobetested)
  for (i in grep("HadCo", vartobetested):endofvars) {
    pmresults[[i]] <- independence_test(eval(parse(text=
      paste(vartobetested[i], "~ Group"))), data = lvSample,
      distribution = approximate(B=10000))
    MeansAndN <- rbind(MeansAndN, 
      c(as.numeric(by(
        lvSample[, eval(parse(text=paste(vartobetested[i])))], 
        lvSample[, Group]
      , mean, na.rm = T)),
      as.numeric(by(
        lvSample[, eval(parse(text=paste(vartobetested[i])))], 
        lvSample[, Group]
      , length))))
  }
  #pmresults[[1]]@statistic@teststatistic
  Pmtresults <- NULL
  for (i in 1:length(vartobetested)) 
    Pmtresults <- rbind(Pmtresults, 
      c(vartobetested[i], MeansAndN[i, ],
        attributes(pvalue(pmresults[[i]]))["conf.int"]$conf.int[1:2],
        pvalue(pmresults[[i]])
        ))
  Pmtresults <- data.table(Pmtresults)
  setnames(Pmtresults, 
    c("variables", 
      paste0(rep(c("mean", "N"), each = 2), c(".increased", ".noincrease")), 
      "pvalue.lower", "pvalue.upper", "pvalue"))
  colss <- c(
    paste0(rep(c("mean", "N"), each = 2), c(".increased", ".noincrease")), 
    "pvalue.lower", "pvalue.upper", "pvalue")
  Pmtresults[, (colss) := lapply(.SD, as.numeric), .SDcols = colss]
  Pmtresults[, (colss[1:2]) := lapply(.SD, round, 2), .SDcols = colss[1:2]]
  Pmtresults[, (colss[3:4]) := lapply(.SD, round, 0), .SDcols = colss[3:4]]
  Pmtresults[, (colss[5:7]) := lapply(.SD, round, 5), .SDcols = colss[5:7]]
  setcolorder(Pmtresults, c(1:6, 8, 7))
  setnames(Pmtresults, c("variables", rep(c("increased", "not increased"), 2), 
    "lowerbound", "estimate", "upperbound"))
  if (s == 4) setnames(Pmtresults, c("variables", rep(c("received", "not received"), 2), 
    "lowerbound", "estimate", "upperbound"))
  Pmtresults[, variables := paste0("\\makebox[2.5cm]{\\hfill ", variables, "}")]
  pmt <- latextab(as.matrix(Pmtresults), 
    hleft = c(rep("\\scriptsize\\hfill$", 3), rep("\\scriptsize\\hfil$", ncol(Pmtresults)-3)), 
    hcenter = c(2.5, rep(1.3, ncol(Pmtresults)-1)), hright = "$", 
    headercolor = "gray80", adjustlineskip = "-.2ex", delimiterline= NULL,
    alternatecolor = "gray90",
    addseparatingcols = c(3, 5)-1, separatingcolwidth = c(.2, .2),
    separatingcoltitle = c("mean", "N", "$p$ value"))
#   pmt <- matrix(c(pmt[1, ], 
#     "\\makebox[2.5cm]{\\hfil\\footnotesize\\cellcolor{gray80} variables} & \\multicolumn{2}{c}{\\hfil\\footnotesize\\cellcolor{gray80} mean} & & \\multicolumn{2}{c}{\\hfil\\footnotesize\\cellcolor{gray80} N} & & \\multicolumn{3}{c}{\\hfil\\footnotesize\\cellcolor{gray80} p-values}\\\\",
#     "\\cline{2-3} \\cline{5-6} \\cline{8-10}\\\\[-2ex]",
#     pmt[-1, ]))
  write.tablev(pmt,  
    paste0(pathsaveHere, PermSamples[s], "PermutationTestResults.tex"), 
    colnamestrue = F)
}
@

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: Permutation tests of \textsf{traditional} arm members that increased vs. not-increased cow ownership\label{tab permutation trad cow}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, PermSamples[1], "PermutationTestResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & Permutation tests of each variables between members who increased cow ownership and who did not increase cow ownership in the \textsf{traditional} arm. Number of repetition is set at 10000. \textsf{R} package \textsf{coin} is used, and \textsf{global} option is used in the \textsf{pvalue} function. Columns under \textsf{mean} show means of both groups for each variates. Columns under \textsf{N} show number of observations of both groups for each variates. Columns under \textsf{p-values} show $p$ values of the null hypothesis of equal means. \\
& 2. & Baseline information is used for \textsf{HeadyLiteracy, HeadAge, HHsize, FloodInd1} with numbers of observation \Sexpr{table(arIN1[,Group])}, baseline information for \textsf{HAssetAmount, PAssetAmount, AssetAmount} with number of observations \Sexpr{table(asIN1[,Group])}, final round information is used for \textsf{dummyHadCows, NumCowsOwnedAtRd1, ReceivedCredit} with number of observations \Sexpr{table(lvIN1[,Group])} for increased and no change in cow ownership groups, respectively. The number of observations differ due to missingness of information and attrition.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: Permutation tests of \textsf{traditional} arm members who received credits and only increased vs. increased-and-decreased cow ownership\label{tab permutation trad cow 2}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, PermSamples[2], "PermutationTestResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & Permutation tests of each variables between loan receiving members who increased but never decreased cow ownership and who increased and decreased cow ownership in the \textsf{traditional} arm. Number of repetition is set at 10000. \textsf{R} package \textsf{coin} is used, and \textsf{global} option is used in the \textsf{pvalue} function. Columns under \textsf{mean} show means of both groups for each variates. Columns under \textsf{N} show number of observations of both groups for each variates. Columns under \textsf{p-values} show $p$ values of the null hypothesis of equal means. \\
& 2. & Baseline information is used for \textsf{HeadyLiteracy, HeadAge, HHsize, FloodInd1} with numbers of observation \Sexpr{table(arIN[,Group])}, baseline information for \textsf{HAssetAmount, PAssetAmount, AssetAmount} with number of observations \Sexpr{table(asIN[,Group])}, final round information is used for \textsf{dummyHadCows, NumCowsOwnedAtRd1, ReceivedCredit} with number of observations \Sexpr{table(lvIN[,Group])} for increased and no change in cow ownership groups, respectively. The number of observations differ due to missingness of information and attrition.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: Permutation tests of all members who received credits and only increased vs. increased-and-decreased cow ownership\label{tab permutation trad cow 3}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, PermSamples[3], "PermutationTestResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & Permutation tests of each variables between loan receiving members who increased but never decreased cow ownership and who increased and decreased cow ownership in all arms. Number of repetition is set at 10000. \textsf{R} package \textsf{coin} is used, and \textsf{global} option is used in the \textsf{pvalue} function. Columns under \textsf{mean} show means of both groups for each variates. Columns under \textsf{N} show number of observations of both groups for each variates. Columns under \textsf{p-values} show $p$ values of the null hypothesis of equal means. \\
& 2. & Baseline information is used for \textsf{HeadyLiteracy, HeadAge, HHsize, FloodInd1} with numbers of observation \Sexpr{table(arIN[,Group])}, baseline information for \textsf{HAssetAmount, PAssetAmount, AssetAmount} with number of observations \Sexpr{table(asIN[,Group])}, final round information is used for \textsf{dummyHadCows, NumCowsOwnedAtRd1, ReceivedCredit} with number of observations \Sexpr{table(lvIN[,Group])} for increased and no change in cow ownership groups, respectively. The number of observations differ due to missingness of information and attrition.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: Permutation tests of all members who received credits vs. not received credits\label{tab permutation cow 4}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, PermSamples[4], "PermutationTestResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & Permutation tests of each variables between loan receiving members and non receiving members in all arms. Number of repetition is set at 10000. \textsf{R} package \textsf{coin} is used, and \textsf{global} option is used in the \textsf{pvalue} function. Columns under \textsf{mean} show means of both groups for each variates. Columns under \textsf{N} show number of observations of both groups for each variates. Columns under \textsf{p-values} show $p$ values of the null hypothesis of equal means. \\
& 2. & Baseline information is used for \textsf{HeadyLiteracy, HeadAge, HHsize, FloodInd1} with numbers of observation \Sexpr{table(arIN[,Group])}, baseline information for \textsf{HAssetAmount, PAssetAmount, AssetAmount} with number of observations \Sexpr{table(asIN[,Group])}, final round information is used for \textsf{dummyHadCows, NumCowsOwnedAtRd1, ReceivedCredit} with number of observations \Sexpr{table(lvIN[,Group])} for increased and no change in cow ownership groups, respectively. The number of observations differ due to missingness of information and attrition.
\end{tabular}
\end{minipage}

<<HHs with iga increase and cow ownership>>=
adw2 <- readRDS(paste0(path1234, "admin_data_wide2.rds"))
iga <- adw2[, .(hhid, Arm, Date, iga11st, iga12nd, iga13rd)]
setnames(iga, c("hhid", "Arm", "Date", paste0("iga", 1:3)))
iga[, NumIGA := sum(!is.na(iga1)) + sum(!is.na(iga2)) + sum(!is.na(iga3)), by = .(hhid, Date)]
igaIncrease <- iga[grepl("tr", Arm) &
  hhid %in% lvw[CowOx.totdiff > 0 & grepl("tr", Arm), hhid], .(
    CowAsIGA = any(grepl("Cow|ox", iga1) | grepl("Cow|ox", iga2) | grepl("Cow|ox", iga3))
  ), by = hhid]
igaNochange <- iga[grepl("tr", Arm) &
  !(hhid %in% lvw[CowOx.totdiff > 0 & grepl("tr", Arm), hhid]), .(
    CowAsIGA = any(grepl("Cow|ox", iga1) | grepl("Cow|ox", iga2) | grepl("Cow|ox", iga3))
  ), by = hhid]
igaIncrease[, Group := "increased"]; igaNochange[, Group := "no change"]
igaIN <- rbindlist(list(igaIncrease, igaNochange))
igaIN[, Group := factor(Group, levels = c("increased", "no change"))]
tb <- table(igaIN[, .(Group, CowAsIGA)])
@
Do these household who increased cow ownership report cows as IGA? Among who increased cow ownership, \Sexpr{tb["increased", "TRUE"]} report cow or ox as IGA at least once and \Sexpr{tb["increased", "FALSE"]} (\Sexpr{round((tb["increased", "FALSE"]/sum(tb["increased", ]))*100, 0)}\%) do not. \gobblepars
<<merge lvo with iga from admin data>>=
lvo <-  readRDS(paste0(pathsaveHere, "LivestockAdminDataUsedForEstimation.rds"))
lvo[, LivestockType := LivestockCode]
lvo[grepl("Ox|Cow", LivestockCode), LivestockType := "Cow/Ox"]
lvo[grepl("Goat|She", LivestockCode), LivestockType := "Goat/Sheep"]
lvo[grepl("Duc|Hen", LivestockCode), LivestockType := "Poultry"]
lvo[, LivestockType := factor(LivestockType)]
adw2 <- readRDS(paste0(path1234, "admin_data_wide2.rds"))
iga <- adw2[, .(hhid, Arm, Date, iga11st, iga12nd, iga13rd)]
setnames(iga, c("hhid", "Arm", "Date", paste0("iga", 1:3)))
igaCow <- iga[, .(
    CowAsIGA = any(grepl("Cow|ox", iga1) | grepl("Cow|ox", iga2) | grepl("Cow|ox", iga3))
    ), by = .(Arm, hhid)]
setkey(igaCow, Arm, hhid)
setkey(lvo, Arm, hhid)
lvoi <- igaCow[lvo]
@
Below tabulation shows reported IGA as cows/oxen against cow/ox ownership.
<<reported IGA as cows/oxen against cow/ox ownership>>=
table0(
  lvoi[, 
  .(CowAsIGA = CowAsIGA[1], Cow = any(NumCows > 0)), by = hhid][, 
  .(CowAsIGA, Cow)]
  )
@
We need to modify IGA summary by using livestock ownership data.



\subsection{Assets+Livestock}



<<ReadTrimAssetFDData again, cache = F, warning = F, child='c:/data/GUK/analysis/program/ReadTrimAssetFDData.rnw'>>=
<<ReadTrimLivestockFDData again, cache = F, child='c:/data/GUK/analysis/program/ReadTrimLivestockFDData.rnw'>>=
<<merge assets and livestock data, cache = F,  warning = F, child='c:/data/GUK/analysis/program/MergeAssetsAndLivestockTakeFD.rnw'>>=
@
<<AssetLivestock set parameters>>=
FileName <- "AssetLivestock"
FileNameHeader <- 
  c("", "Grace", "PovertyStatus", "Size", 
    "TInt", "TIntGrace", "TIntSize", "Rd24Diff", "Rd24DiffGrace", "Rd24DiffPovertyStatus", "Rd24DiffSize")
alsuffixes <- c("", "G", "P", "S", "T", "TG", "TS", "D", "DG", "DP", "DS")
listheader <- paste0("al", alsuffixes)
DataToUse1 <- rep("dAL1d", 6)
DataToUse2 <- rep("dAL2d", 6)
Addseparatingcols <- NULL; Separatingcolwidth <- NULL
Separatingcoltitle <- NULL
Regressands <- rep("TotalValue", 6)
tableboxwidth <- 4.5
<<asset livestock regression select covariates, echo = T>>=
source(paste0(pathprogram, "AssetLivestockCovariateSelection.R"))
<<asset livestock regression estimation>>=
exclheader <- paste0("excl", alsuffixes)
source(paste0(pathprogram, "FDEstimationFile.R"))
<<Total values, warning = F, message = F, fig.align='center', fig.height = 3, fig.width = 10, fig.cap = paste0("Total asset values", "\\\\ {\\footnotesize Sum of assets and livestock holding values.\\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
g <- ggplot(data = ALfig, aes(group = tee)) + 
#  geom_point(size = .1, position = position_dodge(width = .5)) +
#  geom_smooth(span = .5, aes(colour = Arm, group = Arm)) +
  #scale_x_log10(breaks = c(1, 100, 1000, 10000, 20000, 30000, 50000)) +
  geom_boxplot(aes(x= tee, y = TotalValue, colour = Arm))+
  #scale_y_log10(breaks = c(1, 1000, 5000, 10000, 20000, 50000, 100000, 500000)) +
  scale_y_continuous(breaks = seq(0, 100000, 10000), limits = c(0, 100000)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1), 
   strip.text.y = element_text(colour = "blue"), legend.position = "none") +
  facet_grid(. ~ Arm)
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "SumOfAssetsLivestockValues.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
<<Total values by Hadcows, warning = F, message = F, fig.align='center', fig.height = 5, fig.width = 10, fig.cap = paste0("Total asset values by cow holding at baseline", "\\\\ {\\footnotesize Sum of assets and livestock holding values.\\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
g <- ggplot(data = ALfig, 
    aes(x = tee, y = TotalValue, group = factor(tee), colour = factor(dummyHadCows))) + 
  geom_boxplot(position = position_dodge(width = 1))+
  scale_y_continuous(breaks = seq(0, 100000, 10000), limits = c(0, 100000)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust = 1), 
   strip.text.y = element_text(colour = "blue"), legend.position = "none") +
  facet_grid(dummyHadCows ~ Arm)
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "TotalValuesByInitialCowHolding.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
<<>>=
# dummy chunk
@

\clearpage
\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of total assets\label{tab FD total assets}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "AssetLivestockFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+k}\equiv x_{t+k} - x_{t}$  for $k=1, 2, \dots$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Household assets do not include livestock. Regressions (1)-(3), (5)-(6) use only arm and calendar information. (4) and (7) use previous six month repayment and saving information which is lacking in rd 1, hence starts from rd 2.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of total assets, moderately poor vs. ultra poor\label{tab FD total assets2}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "AssetLivestockPovertyStatusFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+k}\equiv x_{t+k} - x_{t}$  for $k=1, 2, \dots$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Household assets do not include livestock. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of total assets, small vs. large size loans\label{tab FD total assets3}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "AssetLivestockSizeFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+k}\equiv x_{t+k} - x_{t}$  for $k=1, 2, \dots$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Household assets do not include livestock. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of total assets, with vs. without a grace period\label{tab FD total assets4}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "AssetLivestockGraceFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+k}\equiv x_{t+k} - x_{t}$  for $k=1, 2, \dots$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Household assets do not include livestock. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of total assets, round 2 and 4 comparison\label{tab FD total assets rd24}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "AssetLivestockRd24DiffFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates between round 2 and 4. A first-difference is defined as $\Delta x_{t+k}\equiv x_{t+k} - x_{t}$ for $k=1, 2, \dots$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Household assets do not include livestock. Regressions (1)-(3), (5)-(6) use only arm and calendar information. (4) and (7) use previous six month repayment and saving information which is lacking in rd 1, hence starts from rd 2.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of total assets, round 2 and 4 comparison, grace period\label{tab FD total assets rd24 grace}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "AssetLivestockRd24DiffGraceFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates between round 2 and 4. A first-difference is defined as $\Delta x_{t+k}\equiv x_{t+k} - x_{t}$ for $k=1, 2, \dots$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Household assets do not include livestock. Regressions (1)-(3), (5)-(6) use only arm and calendar information. (4) and (7) use previous six month repayment and saving information which is lacking in rd 1, hence starts from rd 2.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of total assets, round 2 and 4 comparison, ultra poor vs. moderately poor\label{tab FD total assets rd24 poor}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "AssetLivestockRd24DiffPovertyStatusFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates between round 2 and 4. A first-difference is defined as $\Delta x_{t+k}\equiv x_{t+k} - x_{t}$ for $k=1, 2, \dots$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Household assets do not include livestock. Regressions (1)-(3), (5)-(6) use only arm and calendar information. (4) and (7) use previous six month repayment and saving information which is lacking in rd 1, hence starts from rd 2.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}


\begin{palepinkleftbar}
\begin{finding}
\ref{Figure Total values by Hadcows} seems to show that more experienced (or wealthier) members under \textsf{large grace} and \textsf{cow} arms did not increase the asset holding as much as their counterpart who are less experienced. More experienced members under \textsf{traditional} arm show higher increases in assets relative to their less experienced counterpart.
\end{finding}
\end{palepinkleftbar}

\subsection{Incomes}


<<ReadTrimIncomeFDData, cache = F, eval = F, child='c:/data/GUK/analysis/program/ReadTrimIncomeFDData.rnw'>>=
<<ReadTrimIncomeFDData using R file>>=
source(paste0(pathprogram, "ReadTrimIncomeFDData.R"))
@

Income sources are mainly labour incomes (\textsf{lab}) and farm revenues (\textsf{far}) with \Sexpr{nrow(lab)} and \Sexpr{nrow(far)} observations, respectively. After first-differencing, they become \Sexpr{nrow(dlabd)} and \Sexpr{nrow(dfard)} observations, with \Sexpr{table(dlabd[, Tee])} households observed for \Sexpr{as.numeric(names(table(dlabd[, Tee])))+1} times. 

Obs for survey labour income.
<<Obs for survey labour income>>=
table(dlabd[, tee])
@
Obs for survey labour income and admin repayment data.
<<Obs for survey labour income data>>=
table(dlabRd[, tee])
<<Obs for farm income data>>=
table(dfarRd[, tee])
@
Obs for survey farm revenue.
<<Obs for survey farm revenue>>=
table(dfard[, tee])
@
Obs for survey farm revenue and admin repayment data.
<<>>=
table(dfarRd[, tee])
<<income regression set parameters>>=
FileName <- "Incomes"
lbsuffixes <- c("", "g", "p", "s")
listheader <- paste0("lb", lbsuffixes)
Regressands <- c(rep("TotalHHLabourIncome", 4), rep("TotalRevenue", 3))
DataToUse1 <- DataToUse2 <- c(rep("dlabd", 3), "dlabRd", rep("dfard", 2), "dfarRd")
Addseparatingcols = 4; Separatingcolwidth = .2
Separatingcoltitle = c("Labour income (Tk)", "Farm income (Tk)")
<<incomes select covariates, echo = T>>=
source(paste0(pathprogram, "IncomeCovariateSelection.R"))
<<income FD estimation>>=
FileNameHeader <- c("", "Grace", "PovertyStatus", "Size")
exclheader <- paste0("excl", lbsuffixes)
source(paste0(pathprogram, "FDEstimationFile.R"))
<<incomes select covariates robustness, echo = T>>=
source(paste0(pathprogram, "IncomeCovariateSelectionRobustness.R"))
<<income FD estimation robustness>>=
FileNameHeader <- paste0(FileNameHeader, "Robustness")
exclheader <- paste0("excl", lbsuffixes)
source(paste0(pathprogram, "FDEstimationFile.R"))
<<>>=
#dummy chunk
@

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of incomes\label{tab FD incomes}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "IncomesFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Labour income is in 1000 Tk unit andis sum of all earned labour incomes. Farm revenue is total of agricultural produce sales. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of incomes, moderately poor vs. ultra poor\label{tab FD incomes2}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "IncomesPovertyStatusFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Labour income is in 1000 Tk unit andis sum of all earned labour incomes. Farm revenue is total of agricultural produce sales. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of incomes, loan size\label{tab FD incomes3}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "IncomesSizeFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Labour income is in 1000 Tk unit andis sum of all earned labour incomes. Farm revenue is total of agricultural produce sales. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of incomes, with vs. without a grace period\label{tab FD incomes4}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "IncomesGraceFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Labour income is in 1000 Tk unit andis sum of all earned labour incomes. Farm revenue is total of agricultural produce sales. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of incomes, small vs. large size loans\label{tab FD incomes5}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "IncomesSizeFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Labour income is in 1000 Tk unit andis sum of all earned labour incomes. Farm revenue is total of agricultural produce sales. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

Robustness: \textsc{\small Table \ref{tab FD incomes HH size}} shows that members from larger household size (defined as more than 2 adults) have a higher labour income increase in rd 2-3 and 3-4. This suggests existence of surplus labour in households and local employment opportunities. 


\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of incomes, small vs. large HH size samples\label{tab FD incomes HH size}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "IncomesRobustnessFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Labour income is in 1000 Tk unit andis sum of all earned labour incomes. Farm revenue is total of agricultural produce sales. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}


\begin{palepinkleftbar}
\begin{finding}
\textsc{\small Table \ref{tab FD incomes}} (1) and (3) show a general decrease in rd 1 - 2 period and a general increase in rd 2 - 4 periods for labour incomes. (2) and (4) suggest \textsf{Large grace} arm saw a greater swing (decrease and increases) which resulted in overall significant mean increase of \Sexpr{round(lb1$est[grepl("ace$", rownames(lb1$est)), "Estimate"], 2)} (at $p$ value of \Sexpr{round(lb1$est[grepl("ace$", rownames(lb1$est)), "Pr(>|t|)"]*100, 2)}\%), yet not statistically different from \textsf{traditional}, while other arms have estimates closer to \textsf{traditional}. This labour income response can be due to the flood in rd 1 which reduced the labour incomes while repayment burden in later rounds prompted households to earn more labour incomes. Strong positive correlation with other members' previous 6 month repayment in (4) may be due to concerted peer efforts in repayment. Farm revenues do not show any systematic trend.
\end{finding}
\end{palepinkleftbar}


\subsection{Consumption}

<<ReadTrimConsumptionFDData, cache = F, child='c:/data/GUK/analysis/program/ReadTrimConsumptionFDData.rnw'>>=
@

Consumption is observed in rd 2-4. There are \Sexpr{nrow(con)} observations, with first-differencing, it becomes \Sexpr{nrow(dcond)} observations with \Sexpr{table(dcond[, Tee])} households observed for \Sexpr{as.numeric(names(table(dcond[, Tee])))+1} times. 

<<consumption regression set parameters>>=
FileName <- "Consumption"
cnsuffixes <- c("", "g", "p", "s")
listheader <- paste0("cn", cnsuffixes)
Regressands <- c(rep("PCExpenditure", 4), rep("PCHygieneExpenditure", 3))
DataToUse1 <- DataToUse2 <- c(rep("dcond", 3), "dconRd", rep("dcond", 2), "dconRd")
Addseparatingcols = 4; Separatingcolwidth = .2
Separatingcoltitle = c("Per capita consumption (Tk)", "Per capita food consumption (Tk)")
<<consumption select covariates, echo = T>>=
source(paste0(pathprogram, "ConsumptionCovariateSelection.R"))
<<consumption estimation>>=
FileNameHeader <- c("", "Grace", "PovertyStatus", "Size")
exclheader <- paste0("excl", cnsuffixes)
source(paste0(pathprogram, "FDEstimationFile.R"))
<<consumption select covariates robustness, echo = T>>=
source(paste0(pathprogram, "ConsumptionCovariateSelectionRobustness.R"))
<<consumption estimation robustness>>=
FileNameHeader <- paste0(FileNameHeader, "Robustness")
exclheader <- paste0("excl", cnsuffixes)
source(paste0(pathprogram, "FDEstimationFile.R"))
<<>>=
#dummy chunk
@


\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of consumption\label{tab FD consumption}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "consumptionFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Consumption is annualised values. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}


\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of consumption, moderately poor vs. ultra poor\label{tab FD consumption2}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "consumptionPovertyStatusFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Consumption is annualised values. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}


\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of consumption, large vs. small size loans\label{tab FD consumption3}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "consumptionSizeFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Consumption is annualised values. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of consumption, with vs. without a grace period\label{tab FD consumption4}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "consumptionGraceFDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Consumption is annualised values. \\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}

\hspace{-1cm}\begin{minipage}[t]{14cm}
\hfil\textsc{\normalsize Table \refstepcounter{table}\thetable: FD estimation of consumption, loan recipients vs. pure control\label{tab FD consumption pure control}}\\
\setlength{\tabcolsep}{1pt}
\setlength{\baselineskip}{8pt}
\renewcommand{\arraystretch}{.55}
\hfil\begin{tikzpicture}
\node (tbl) {\input{\Sexpr{paste0(pathsaveHere, "Consumption", FileNameHeader[1], "FDEstimationResults.tex")}}};
%\input{c:/dropbox/data/ramadan/save/tablecolortemplate.tex}
\end{tikzpicture}\\
\renewcommand{\arraystretch}{.8}
\setlength{\tabcolsep}{1pt}
\begin{tabular}{>{\hfill\scriptsize}p{1cm}<{}>{\hfill\scriptsize}p{.25cm}<{}>{\scriptsize}p{12cm}<{\hfill}}
Source:& \multicolumn{2}{l}{\scriptsize Estimated with GUK administrative and survey data.}\\
Notes: & 1. & First-difference estimates of round 2 - 4. A first-difference is defined as $\Delta x_{t+1}\equiv x_{t+1} - x_{t}$. Saving and repayment misses are taken from administrative data and merged with survey data at Year-Month of survey interviews. Intercept terms are omitted in estimating equations. Sample is continuing members and replacing members of early rejecters and received loans prior to 2015 Janunary. Regressions (1)-(3), (5)-(6) use only arm and calendar information. (4) and (7) use previous six month repayment and saving information which is lacking in rd 1, hence starts from rd 2. Pure controls are households who rejected to receive a loan.\\
& 2. & ${}^{***}$, ${}^{**}$, ${}^{*}$ indicate statistical significance at 1\%, 5\%, 10\%, respetively. Standard errors are clustered at group (village) level.
\end{tabular}
\end{minipage}


\begin{palepinkleftbar}
\begin{finding}
\textsc{\small Table \ref{tab FD consumption}} uses rd 2 - 4 data and shows an increase in per member consumption in rd 2 - 3 period. The estimates are imprecise for all interaction terms. Continued increases in consumption hints welfare gains, but do not differ by arms. Per member food consumption increases in rd 2- 3 period but decreases in rd 3 - 4 period.
\end{finding}
\end{palepinkleftbar}


\subsection{IGA}

<<warning = F>>=
adw2 <- readRDS(paste0(path1234, "admin_data_wide2.rds"))
iga <- adw2[, .(hhid, Arm, Year, Month, Date, iga11st, iga12nd, iga13rd)]
setnames(iga, c("hhid", "Arm", "Year", "Month", "Date", paste0("iga", 1:3)))
lvo <-  readRDS(paste0(pathsaveHere, "LivestockAdminDataUsedForEstimation.rds"))
lvo[, LivestockType := LivestockCode]
lvo[grepl("Ox|Cow", LivestockCode), LivestockType := "Cow/Ox"]
lvo[grepl("Goat|She", LivestockCode), LivestockType := "Goat/Sheep"]
lvo[grepl("Duc|Hen", LivestockCode), LivestockType := "Poultry"]
lvo[, LivestockType := factor(LivestockType)]
igaCow <- iga[, .(
    CowAsIGA = any(grepl("Cow|ox", iga1) | grepl("Cow|ox", iga2) |
     grepl("Cow|ox", iga3))), 
    by = .(Arm, hhid)]
setkey(igaCow, Arm, hhid)
setkey(lvo, Arm, hhid)
lvoi0 <- igaCow[lvo]
lvoi0[, CowAsIGA := CowAsIGA[1], by = hhid]
setkey(iga, Arm, hhid, Year, Month)
setkey(lvoi0, Arm, hhid, Year, Month)
lvoi <- iga[lvoi0]
@
As written in the above at livestock section, IGA is misreported. 
<<IGA is misreported>>=
table0(
  lvoi[, .(CowAsIGA, PositiveCows = NumCows > 0)]
  )
table(
  lvoi[, .(CowAsIGA, PositiveCows = NumCows > 0, survey)]
  , useNA = "ifany")
@
\textsf{CowAsIGA} = T, \textsf{NumCows} $=0$: \textsf{CowAsIGA} = T may be reported as an intention, not an actual activity.
<<CowAsIGA TRUE may be reported as an intention not an actual activity>>=
table(
  lvoi[CowAsIGA & NumCows == 0, .(survey, Arm)]
  , useNA = "ifany")
@
\textsf{CowAsIGA} = F, \textsf{NumCows} $>0$: 
<<CowAsIGA is FALSE NumCows is positve>>=
table(
  lvoi[!CowAsIGA & NumCows > 0, .(survey, Arm)]
  , useNA = "ifany")
@
Revise IGA:
\begin{itemize}
\vspace{1.0ex}\setlength{\itemsep}{1.0ex}\setlength{\baselineskip}{12pt}
\item	\textsf{CowAsIGA} = T, \textsf{NumCows} $=0$ for all rounds: \textsf{CowAsIGA} = F.
\item	\textsf{CowAsIGA} = F, \textsf{NumCows} $>0$ for any round: \textsf{CowAsIGA} = T.
\end{itemize}
<<Revise IGA>>=
lvoi[, NoCowAllRounds := F]
lvoi[any(NumCows > 0), NoCowAllRounds := T, by = hhid]
lvoi[CowAsIGA & NoCowAllRounds, CowAsIGA := FALSE]
lvoi[!CowAsIGA & NoCowAllRounds, CowAsIGA := TRUE]
lvoi[, CowAsIGA := CowAsIGA[1], by = hhid]
@
Find HHs who do not report cows as IGA and copy \textsf{CowAsIGA}.
<<Find HHs who do not report cows as IGA and copy CowAsIGA>>=
# lvoi[!(CowAsIGA) & NumCows > 0 & survey != 1, 
#   .(Arm, hhid, survey, iga1, iga2, iga3, NumCows, CowAsIGA)]
# table0(lvoi[!(CowAsIGA) & NumCows > 0 & survey != 1, 
#   .(survey, Arm)])
lvoi[, NumIGA := uniqueN(unlist(.SD), na.rm = T), by = .(hhid, survey), 
  .SDcols = paste0("iga", 1:3)]
lvoi[is.na(iga1), NumIGA := 0L] 
# assign cow in iga3 if NumIGA <= 2
lvoi[!(CowAsIGA) & NumCows > 0 & survey != 1 & NumIGA <= 2, iga3 := "Cow rearing"] 
# it is only 1 HH who has 3 igas. Replace nut corn farming with Cow in iga3
lvoi[!(CowAsIGA) & NumCows > 0 & survey != 1 & NumIGA == 3, iga3 := "Cow rearing"] 
lvoi[, NumIGA := uniqueN(unlist(.SD), na.rm = T), by = .(hhid, survey), 
  .SDcols = paste0("iga", 1:3)]
<<create data table lvoi.uw>>=
setkey(lvoi, NumIGA, iga1, iga2, iga3)
lvoi.unique <- unique(lvoi[, .(NumIGA, iga1, iga2, iga3)])
lvoi.unique <- lvoi[lvoi.unique, .(N = .N/48), by = .EACHI]
setorder(lvoi.unique, -NumIGA, -N, iga1, iga2, iga3)
setkey(lvoi, NumIGA, iga1, Arm)
lvoiArm.unique <- unique(lvoi[, .(NumIGA, iga1, Arm)])
lvoiArm.unique <- lvoi[lvoiArm.unique, .(N = .N/48), by = .EACHI]
setorder(lvoiArm.unique, -NumIGA, -N, iga1)
for (i in 1:3) {
  lvoi[, paste0("IGA.", i) := as.character(NA)]
  lvoi[grepl("ow|oxen", eval(parse(text = paste0("iga", i)))), 
    paste0("IGA.", i) := "cow"]
  lvoi[grepl("Goa|heep", eval(parse(text = paste0("iga", i)))), 
    paste0("IGA.", i) := "goat sheep"]
  lvoi[grepl("small", eval(parse(text = paste0("iga", i)))), 
    paste0("IGA.", i) := "small trade"]
  lvoi[grepl("house|land", eval(parse(text = paste0("iga", i)))), 
    paste0("IGA.", i) := "house land"]
  lvoi[grepl("machi", eval(parse(text = paste0("iga", i)))), 
    paste0("IGA.", i) := "machinery"]
  lvoi[grepl("addy|nut", eval(parse(text = paste0("iga", i)))), 
    paste0("IGA.", i) := "paddy nuts corn"]
  lvoi[, paste0("IGA.", i) := factor(eval(parse(text = paste0("IGA.", i))), 
    levels = c("cow", "goat sheep", "machinery", "small trade", "house land", "paddy nuts corn", NA))]
}
lvoi[, NumIGA := uniqueN(unlist(.SD), na.rm = T), by = .(hhid, survey), 
  .SDcols = paste0("IGA.", 1:3)]
setkey(lvoi, NumIGA, IGA.1, IGA.2, IGA.3, Arm)
lvoi.unique3 <- unique(lvoi[, .(NumIGA, IGA.1, IGA.2, IGA.3, Arm)])
# by = EACHI counts the number of matches in lvoi for each row in lvoi.unique3 (then divide with 48)
lvoi.unique3 <- lvoi[lvoi.unique3, .(N = .N), by = .EACHI]
# unify same iga reported separately IGA.1, 2, 3
lvoi.unique3[, Dum := 1:.N]
lvoi.u3l <- reshape(lvoi.unique3, direction = "long", 
  idvar = c("Arm", "NumIGA", "N", "Dum"),
  varying = grepout("^I", colnames(lvoi.unique3)))
setorder(lvoi.u3l, NumIGA, Arm, Dum, time)
lvoi.u3lNA <- lvoi.u3l[, .(Arm, N, AllNA = all(is.na(.SD))), by = Dum, .SDcols = "IGA"]
lvoi.u3lNA <- unique(lvoi.u3lNA[(AllNA), ])
lvoi.u3lNA[, AllNA:= NULL]
lvoi.u3lNA[, time := 1]
lvoi.u3l <- lvoi.u3l[!is.na(IGA), ]
# if NumIGA == 1, set time == 1 so the only IGA will be recorded as IGA1 and drop duplicates
lvoi.u3l[NumIGA == 1, time := 1]
lvoi.u3l <- lvoi.u3l[!duplicated(lvoi.u3l), ]
lvoi.u3l <- lvoi.u3l[!duplicated(lvoi.u3l[, .(Dum, Arm, IGA)]), ]
lvoi.u3l[, time := as.integer(time)]
lvoi.u3l[, time := as.integer(1:.N), by = Dum]
lvoi.u <- rbindlist(list(lvoi.u3lNA, lvoi.u3l), use.names = T, fill = T)
lvoi.u[is.na(NumIGA), NumIGA := 0L]
lvoi.uw <- reshape(lvoi.u, direction = "wide", idvar = c("Arm", "NumIGA", "N", "Dum"),
  timevar = "time", v.names = grepout("^I", colnames(lvoi.u)))
lvoi.uw[, Dum := NULL]
lvoi.uw <- lvoi.uw[, .(N = sum(N)), by = .(Arm, NumIGA, IGA.1, IGA.2, IGA.3)]
setorder(lvoi.uw, -NumIGA, -N, Arm, IGA.1, IGA.2, IGA.3)
lvoi.uw[, NumIGA := factor(NumIGA, levels = 3:0)]
<<All IGA choices, warning = F, message = F, fig.align='center', fig.height = 3, fig.width = 10, fig.cap = paste0("All income generatng activity choices", "\\\\ {\\footnotesize All of multiple investment choices are summed by arms and the number of IGAs are plotted as bars. Cow as IGA is corrected with livestock ownership information. \\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
lvoi.uw[, num := 1:.N]
lvoiUL <- reshape(lvoi.uw, direction = "long", idvar = c("num", "NumIGA", "Arm", "N"),
  varying = paste0("IGA.", 1:3))
setnames(lvoiUL, "time", "rank")
setkey(lvoiUL, num, rank)
library(ggplot2)
g <- ggplot(data = lvoiUL[NumIGA != 0 & !is.na(IGA), ], aes(IGA, N)) + 
  geom_col() +
  xlab("IGA choices") +
  theme(axis.text.x = element_text(angle = 30, vjust = .5, hjust = 1), 
    strip.text.y = element_text(colour = "blue"))+
  facet_grid(NumIGA ~ Arm, switch = "y")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "AllIGAChoicesByNumIGAAndArm.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
<<All IGA choices collapsed, warning = F, message = F, fig.align='center', fig.height = 3, fig.width = 10, fig.cap = paste0("All income generatng activity choices collapsed over different number of IGAs", "\\\\ {\\footnotesize All of multiple investment choices are summed by arms and plotted as bars. Cow as IGA is corrected with livestock ownership information.\\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
lvoi.uw[, num := 1:.N]
lvoiUL <- reshape(lvoi.uw, direction = "long", idvar = c("num", "NumIGA", "Arm", "N"),
  varying = paste0("IGA.", 1:3))
setnames(lvoiUL, "time", "rank")
setkey(lvoiUL, num, rank)
library(ggplot2)
g <- ggplot(data = lvoiUL[NumIGA != 0 & !is.na(IGA), ], aes(IGA, N)) + 
  geom_col() +
  xlab("First IGA choices") +
  theme(axis.text.x = element_text(angle = 90, vjust = .5, hjust = 1), 
    strip.text.y = element_text(colour = "blue"))+
  facet_grid(. ~ Arm, switch = "y")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "AllIGAChoicesByArm.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
@


Given that it was minority households who owned a cow at baseline, cow as reported IGA in the first round indicates it is likely to include member's intention, not just actual ownership. So we base IGA according to ownership. \textsc{\small Figure \ref{Figure all livestock holding}} shows that fewer members own poultry and goat/sheep in all arms, while cow ownership exapanded in all arms but least pronounced in \textsf{traditional} arm (see the close-up plots in \textsc{\small Figure \ref{Figure cow holding}}). This suggests a loan triggered the substitution of smaller, less profitable livestock with bigger, and more profitable livestock.
<<>>=
lvo <-  readRDS(paste0(pathsaveHere, "LivestockAdminDataUsedForEstimation.rds"))
lvo[grepl("Go", LivestockCode), NumGoatSheep := sum(number_owned, na.rm = T), 
  by = .(survey, hhid)]
lvo[is.na(NumGoatSheep), NumGoatSheep := 0]
lvo[, NumGoatSheep := NumGoatSheep[!is.na(NumGoatSheep)][1], 
  by = .(survey, hhid)]
lvo[grepl("Chi", LivestockCode), NumChickenDuck := sum(number_owned, na.rm = T), 
  by = .(survey, hhid)]
lvo[is.na(NumChickenDuck), NumChickenDuck := 0]
lvo[, NumChickenDuck := NumChickenDuck[!is.na(NumChickenDuck)][1], 
  by = .(survey, hhid)]
lviga <- lvo[!is.na(survey), .(Arm, hhid, survey, Num.Cow = NumCows, 
  Num.Goat = NumGoatSheep, Num.Chicken = NumChickenDuck)]
lviga[hhid == 7106518, Num.Chicken := 3]
lviga <- reshape(lviga, direction = "long", idvar = c("Arm", "hhid", "survey"),
  varying = grepout("Num", colnames(lviga)))
setnames(lviga, "time", "Livestock")
<<all livestock holding, warning = F, message = F, fig.align='center', fig.height = 10, fig.width = 10, fig.cap = paste0("Livestock holding", "\\\\ {\\footnotesize \\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
g <- ggplot(data = lviga[Num != 0, ], aes(Num, group = Arm)) + 
  geom_histogram(binwidth = 1) +
  xlab("number owned") +
  theme(axis.text.x = element_text(angle = 90, vjust = .5, hjust = 1), 
    strip.text.y = element_text(colour = "blue"))+
  facet_grid(Livestock*Arm ~ survey, switch = "y", scales = "free")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "AllLivestockHoldingByArmAndRd.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
<<cow holding, warning = F, message = F, fig.align='center', fig.height = 4, fig.width = 10, fig.cap = paste0("Livestock holding", "\\\\ {\\footnotesize \\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
g <- ggplot(data = lviga[Num != 0 & grepl("Cow", Livestock), ], aes(Num, group = Arm)) + 
  geom_histogram(binwidth = 1) +
  xlab("number owned") +
  theme(axis.text.x = element_text(angle = 90, vjust = .5, hjust = 1), 
    strip.text.y = element_text(colour = "blue"))+
  facet_grid(Arm ~ survey, switch = "y")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "CowHoldingByArmAndRd.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
<<>>=
adw2 <- readRDS(paste0(path1234, "admin_data_wide2.rds"))
iga <- adw2[, .(hhid, Arm, Date, iga11st, iga12nd, iga13rd)]
setnames(iga, c("hhid", "Arm", "Date", paste0("iga", 1:3)))
#table0(iga[, iga1])
#table0(iga[, iga2])
#table0(iga[, iga3])
setkey(iga, hhid, Date)
iga[, NumIGA := sum(!is.na(iga1)) + sum(!is.na(iga2)) + sum(!is.na(iga3)), by = .(hhid, Date)]
#iga[NumIGA == 0 & !is.na(iga1), ]
setkey(iga, NumIGA, iga1, iga2, iga3)
iga.unique <- unique(iga[, .(NumIGA, iga1, iga2, iga3)])
iga.unique <- iga[iga.unique, .N/48, by = .EACHI]
setnames(iga.unique, "V1", "N")
setorder(iga.unique, -NumIGA, -N, iga1, iga2, iga3)
setkey(iga, NumIGA, iga1, Arm)
igaArm.unique <- unique(iga[, .(NumIGA, iga1, Arm)])
igaArm.unique <- iga[igaArm.unique, .N/48, by = .EACHI]
setnames(igaArm.unique, "V1", "N")
setorder(igaArm.unique, -NumIGA, -N, iga1)
for (i in 1:3) {
  iga[, paste0("IGA.", i) := as.character(NA)]
  iga[grepl("Cow|oxen", eval(parse(text = paste0("iga", i)))), 
    paste0("IGA.", i) := "cow"]
  iga[grepl("Goa|heep", eval(parse(text = paste0("iga", i)))), 
    paste0("IGA.", i) := "goat sheep"]
  iga[grepl("small", eval(parse(text = paste0("iga", i)))), 
    paste0("IGA.", i) := "small trade"]
  iga[grepl("house|land", eval(parse(text = paste0("iga", i)))), 
    paste0("IGA.", i) := "house land"]
  iga[grepl("machi", eval(parse(text = paste0("iga", i)))), 
    paste0("IGA.", i) := "machinery"]
  iga[grepl("addy|nut", eval(parse(text = paste0("iga", i)))), 
    paste0("IGA.", i) := "paddy nuts corn"]
  iga[, paste0("IGA.", i) := factor(eval(parse(text = paste0("IGA.", i))), 
    levels = c("cow", "goat sheep", "machinery", "small trade", "house land", "paddy nuts corn", NA))]
}
setkey(iga, NumIGA, IGA.1, IGA.2, IGA.3, Arm)
iga.unique3 <- unique(iga[, .(NumIGA, IGA.1, IGA.2, IGA.3, Arm)])
# by = EACHI counts the number of matches in iga for each row in iga.unique3 (then divide with 48)
iga.unique3 <- iga[iga.unique3, .(N = .N/48), by = .EACHI]
setorder(iga.unique3, -NumIGA, -N, Arm, IGA.1, IGA.2, IGA.3)
iga.unique3[, NumIGA := factor(NumIGA, levels = 3:0)]
<<IGA choices unrevised, warning = F, message = F, fig.align='center', fig.height = 3, fig.width = 10, fig.cap = paste0("Income generatng activity choices", "\\\\ {\\footnotesize The first income generating activity choices are plotted.\\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
library(ggplot2)
g <- ggplot(data = iga.unique3[NumIGA != 0 & !is.na(IGA.1), ], aes(IGA.1, N)) + 
  geom_col() +
  xlab("First IGA choices") +
  theme(axis.text.x = element_text(angle = 30, vjust = .5, hjust = 1), 
    strip.text.y = element_text(colour = "blue"))+
  facet_grid(NumIGA ~ Arm, switch = "y")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "IGAChoicesUnrevisedByNumIGAAndArm.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
<<All IGA choices unrevised, warning = F, message = F, fig.align='center', fig.height = 3, fig.width = 10, fig.cap = paste0("All income generatng activity choices", "\\\\ {\\footnotesize All of multiple investment choices are summed by arms and the number of IGAs are plotted as bars. \\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
iga.unique3[, num := 1:.N]
igaUL <- reshape(iga.unique3, direction = "long", idvar = c("num", "NumIGA", "Arm", "N"),
  varying = paste0("IGA.", 1:3))
setnames(igaUL, "time", "rank")
setkey(igaUL, num, rank)
library(ggplot2)
g <- ggplot(data = igaUL[NumIGA != 0 & !is.na(IGA), ], aes(IGA, N)) + 
  geom_col() +
  xlab("IGA choices") +
  theme(axis.text.x = element_text(angle = 30, vjust = .5, hjust = 1), 
    strip.text.y = element_text(colour = "blue"))+
  facet_grid(NumIGA ~ Arm, switch = "y")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "AllIGAChoicesUnrevisedByNumIGAAndArm.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
<<All IGA choices collapsed unrevised, warning = F, message = F, fig.align='center', fig.height = 3, fig.width = 10, fig.cap = paste0("All income generatng activity choices collapsed over different number of IGAs", "\\\\ {\\footnotesize All of multiple investment choices are summed by arms and plotted as bars. \\setlength{\\baselineskip}{8pt}}"), fig.lp = 'Figure '>>=
iga.unique3[, num := 1:.N]
igaUL <- reshape(iga.unique3, direction = "long", idvar = c("num", "NumIGA", "Arm", "N"),
  varying = paste0("IGA.", 1:3))
setnames(igaUL, "time", "rank")
setkey(igaUL, num, rank)
library(ggplot2)
g <- ggplot(data = igaUL[NumIGA != 0 & !is.na(IGA), ], aes(IGA, N)) + 
  geom_col() +
  xlab("First IGA choices") +
  theme(axis.text.x = element_text(angle = 90, vjust = .5, hjust = 1), 
    strip.text.y = element_text(colour = "blue"))+
  facet_grid(. ~ Arm, switch = "y")
ggsave(
  paste0(pathprogram, 
    "figure/ImpactEstimationMembership1or4/",
    "AllIGAChoicesUnrevisedByArm.png"),
  g,
  width = 13, height = 6, units = "cm",
  dpi = 300
 )
g
@

\begin{palepinkleftbar}
\begin{finding}
\textsc{\small Figure \ref{Figure All IGA choices}, \ref{Figure All IGA choices collapsed}} show that there are very few members who chose to invest in more than one project for the ``large'' arms, while in the \textsf{traditional} arm, almost no one invested only in one project. Goat/sheep and small trades are the top choices for the first IGA in \textsf{traditional}. This indicates the exitence of both a liquidity constraint and convexity in the production technology of large domestic animals. This also validates our supposition that dairy livestock production is the most preferred and probably the only economically viable investment choice. It reduces a concern that the \textsf{cow} arm may have imposed an unnecessary restriction in an investment choice by forcing to receive a cow. \textsc{\small Figure \ref{Figure All IGA choices collapsed}} shows there are a significant number of cases in the \textsf{traditional} arm that members reportedly raise cows, yet they are also accompanied by pararell projects in smaller livestock production and small trades. Contrasting \textsf{large}, \textsf{large grace} with \textsf{cow} arms, it suggests that entrepreneurship (to the extent that is necessary for dairy livestock production) may not be an impediment for a microfinance loan uptake among members.
\end{finding}
\end{palepinkleftbar}

Together with \textsc{\small Table \ref{tab FD saving}} showing smaller net saving and repayment among \textsf{traditional}, the restriction on a project choice induced by a smaller loaned sum resulted in smaller returns. Between with or no grace period loans, cumulative net saving and repayment are both larger with loans with a grace period. No such difference is found between \textsf{cow} and other arms.


\subsection{Marriage}

<<warning = F>>=
# RosterAdminDataUsedForEstimation.rds has too few traditional arm. Use RosterAdminData.rds.
# ar <- readRDS(paste0(path1234, "RosterAdminDataUsedForEstimation.rds"))
ar <- readRDS(paste0(pathsaveHere, "RosterAdminData.rds"))
ma <- ar[, 
  grepout("Arm|Mem|groupid|^hhid|^mid|Age|sex|Year|Months|surve|marita|curr|Marr|HeadA|HeadL|OtherN|OtherM|RM|creditst|Tra", 
  colnames(ar)), with = F]
# define eligible daughters
ma[, tee := 1:.N, by = .(hhid, mid)]
ma[, MaxT := max(tee), by = .(hhid, mid)]
#table0(ma[MarriedOff & grepl("Fem", sex) & tee == MaxT, .(Year, Age_1)])
ma[, ReadyToMarry := 0L]
ma[AgeComputed >= 10 & AgeComputed <= 40 & 
  grepl("Fe", sex) & grepl("unm", marital), ReadyToMarry := 1L]
ma[, NumEligible := sum(ReadyToMarry), by = .(Arm, survey)]
setkey(ma, Arm, survey, NumEligible)

table0(ma[survey == 1, .(creditstatus, TradGroup)])

reshape(unique(ma[, .(Arm, survey, NumEligible)]), direction = "wide", 
  idvar = "Arm", timevar = "survey", v.names = "NumEligible")
# Count cases eventually getting married but a certain period after disbursement
ma[, AttritBefore3Y := any(max(.SD[, MonthsElapsed], na.rm = T) <= 36), 
  .SDcols = "MonthsElapsed", by = hhid]
ma[, AttritBefore2Y := any(max(.SD[, MonthsElapsed], na.rm = T) <= 24), 
  .SDcols = "MonthsElapsed", by = hhid]
ma[, AttritBefore1Y := any(max(.SD[, MonthsElapsed], na.rm = T) <= 12), 
  .SDcols = "MonthsElapsed", by = hhid]
#ma[(AttritBefore1Y) & grepl("tr", Arm), .(Arm, hhid, mid, Age_1, Year, tee, MonthsElapsed, current)]
@
Tabulate marriage for \textsf{sex} == ``Female" \& \textsf{ReadyToMarry}, where the latter is unmarried females with ages between 10 and 40.
<<>>=
#table0(ma[tee == 1, .(Arm, AttritBefore3Y)])
#table0(ma[tee == 1, .(Arm, AttritBefore2Y)])
setkey(ma, Arm, hhid, mid, survey)
ma[, c("MarriedAfter3Y", "MarriedAfter2Y") := 0L]
ma[!(AttritBefore3Y), MarriedAfter3Y := 
   as.integer(any(.SD[MonthsElapsed > 36, MarriedOff])), 
  .SDcols = "MarriedOff", by = .(hhid, mid)]
ma[!(AttritBefore2Y), MarriedAfter2Y := 
  as.integer(any(.SD[MonthsElapsed > 24, MarriedOff])), 
  .SDcols = "MarriedOff", by = .(hhid, mid)]
ma[!(AttritBefore1Y), MarriedAfter1Y := 
  as.integer(any(.SD[MonthsElapsed > 12, MarriedOff])), 
  .SDcols = "MarriedOff", by = .(hhid, mid)]
M3 <- table0(ma[!AttritBefore3Y & tee == 1 & 
  sex == "Female" & ReadyToMarry, .(Arm, MarriedAfter3Y)])
M2 <- table0(ma[!AttritBefore2Y & tee == 1 &
  sex == "Female" & ReadyToMarry, .(Arm, MarriedAfter2Y)])
M1 <- table0(ma[tee == 1 &
  sex == "Female" & ReadyToMarry, .(Arm, MarriedAfter1Y)])
M0 <- table0(ma[tee == 1 &
  sex == "Female" & ReadyToMarry, .(Arm, MarriedOff)])
@
When we compare the marriage rates, we need to define the denominator sensibly. It should be all relevant aged females that are present in baseline. As we do not want to include marriages immediately after receiving loans, we need to take off some period to count the marriage cases. We will consider 1 year, 2 years, and 3 years. At the same time, there are househods who chose not to receive a loan. 
Then, we need the denominator to be relevant aged females who do not attrit by:
\begin{itemize}
\vspace{1.0ex}\setlength{\itemsep}{1.0ex}\setlength{\baselineskip}{12pt}
\item	1 year (\Sexpr{sum(M1)} individuals), or,
\item	2 years (\Sexpr{sum(M2)} individuals), or,
\item	3 years (\Sexpr{sum(M3)} individuals).
\end{itemize}
<<>>=
ma[, AttritedBefore := "never"]
ma[(AttritBefore1Y), AttritedBefore := "year 1"]
ma[!AttritBefore1Y & AttritBefore2Y, AttritedBefore := "year 2"]
ma[!AttritBefore1Y & !AttritBefore2Y & AttritBefore3Y, AttritedBefore := "year 3"]
ma[, AttritedBefore := factor(AttritedBefore, levels = c(paste("year", 1:3), "never"))]
setkey(ma, Arm, AttritedBefore)
ma[sex == "Female" & ReadyToMarry, 
  .(NumEligible = length(MarriedOff), 
  Married = sum(MarriedOff),
  MarriageRate = round(mean(MarriedOff), 2)), 
  by = .(Arm, AttritedBefore)]
@
\begin{palepinkleftbar}
\begin{finding}
There is very small difference in marriage rates between arms with grace and without grace.
\end{finding}
\end{palepinkleftbar}
<<eval = F>>=
cbind(M1, round(M1/apply(M1, 1, sum), 2))
cbind(M2, round(M2/apply(M2, 1, sum), 2))
cbind(M3, round(M3/apply(M3, 1, sum), 2))
@
